

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="where">
  <meta name="keywords" content="">
  
    <meta name="description" content="Spring Boot + Framework————《Spring Framework》————第一部分 Spring Context1.1 ApplicationContextInitializer初始化 ApplicationContext 12345678910@FunctionalInterfacepublic interface ApplicationContextInitialize">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Boot + Framework">
<meta property="og:url" content="http://example.com/2023/07/30/Spring%E5%AE%B6%E6%97%8F/Spring%20Boot%20+%20Framework/index.html">
<meta property="og:site_name" content="where&#39;s blog">
<meta property="og:description" content="Spring Boot + Framework————《Spring Framework》————第一部分 Spring Context1.1 ApplicationContextInitializer初始化 ApplicationContext 12345678910@FunctionalInterfacepublic interface ApplicationContextInitialize">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/wherezy1/PicGOImageShack/main/images/image-20230730204319825.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wherezy1/PicGOImageShack/main/images/image-20230730223204903.png">
<meta property="og:image" content="http://example.com/Users/where/Library/Application%20Support/typora-user-images/image-20230808210957497.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wherezy1/PicGOImageShack/main/images/image-20230808212447647.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wherezy1/PicGOImageShack/main/images/image-20230730231209293.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wherezy1/PicGOImageShack/main/images/image-20230723170427758.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wherezy1/PicGOImageShack/main/images/image-20230723171852456.png">
<meta property="article:published_time" content="2023-07-29T16:00:00.000Z">
<meta property="article:modified_time" content="2023-09-12T01:06:53.059Z">
<meta property="article:author" content="where">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wherezy1/PicGOImageShack/main/images/image-20230730204319825.png">
  
  
  
  <title>Spring Boot + Framework - where&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Spring Boot + Framework"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-07-30 00:00" pubdate>
          2023年7月30日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          105k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          872 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Spring Boot + Framework</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Spring-Boot-Framework"><a href="#Spring-Boot-Framework" class="headerlink" title="Spring Boot + Framework"></a>Spring Boot + Framework</h1><h1 id="————《Spring-Framework》————"><a href="#————《Spring-Framework》————" class="headerlink" title="————《Spring Framework》————"></a>————《Spring Framework》————</h1><h1 id="第一部分-Spring-Context"><a href="#第一部分-Spring-Context" class="headerlink" title="第一部分 Spring Context"></a>第一部分 Spring Context</h1><h1 id="1-1-ApplicationContextInitializer"><a href="#1-1-ApplicationContextInitializer" class="headerlink" title="1.1 ApplicationContextInitializer"></a>1.1 ApplicationContextInitializer</h1><p>初始化 ApplicationContext</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApplicationContextInitializer</span>&lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ConfigurableApplicationContext</span>&gt; &#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Initialize the given application context.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> applicationContext the application to configure</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">initialize</span><span class="hljs-params">(C applicationContext)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h1 id="1-2-AbstractApplicationContext"><a href="#1-2-AbstractApplicationContext" class="headerlink" title="1.2 AbstractApplicationContext"></a>1.2 AbstractApplicationContext</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractApplicationContext</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DefaultResourceLoader</span><br>		<span class="hljs-keyword">implements</span> <span class="hljs-title class_">ConfigurableApplicationContext</span> &#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Name of the MessageSource bean in the factory.</span><br><span class="hljs-comment">	 * If none is supplied, message resolution is delegated to the parent.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> MessageSource</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">MESSAGE_SOURCE_BEAN_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;messageSource&quot;</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Name of the LifecycleProcessor bean in the factory.</span><br><span class="hljs-comment">	 * If none is supplied, a DefaultLifecycleProcessor is used.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> org.springframework.context.LifecycleProcessor</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> org.springframework.context.support.DefaultLifecycleProcessor</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LIFECYCLE_PROCESSOR_BEAN_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;lifecycleProcessor&quot;</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Name of the ApplicationEventMulticaster bean in the factory.</span><br><span class="hljs-comment">	 * If none is supplied, a default SimpleApplicationEventMulticaster is used.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> org.springframework.context.event.ApplicationEventMulticaster</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> org.springframework.context.event.SimpleApplicationEventMulticaster</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">APPLICATION_EVENT_MULTICASTER_BEAN_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;applicationEventMulticaster&quot;</span>;<br><br><br>	<span class="hljs-keyword">static</span> &#123;<br>		<span class="hljs-comment">// Eagerly load the ContextClosedEvent class to avoid weird classloader issues</span><br>		<span class="hljs-comment">// on application shutdown in WebLogic 8.1. (Reported by Dustin Woods.)</span><br>		ContextClosedEvent.class.getName();<br>	&#125;<br><br><br>	<span class="hljs-comment">/** Logger used by this class. Available to subclasses. */</span><br>	<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Log</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LogFactory.getLog(getClass());<br><br>	<span class="hljs-comment">/** Unique id for this context, if any. */</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> ObjectUtils.identityToString(<span class="hljs-built_in">this</span>);<br><br>	<span class="hljs-comment">/** Display name. */</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">displayName</span> <span class="hljs-operator">=</span> ObjectUtils.identityToString(<span class="hljs-built_in">this</span>);<br><br>	<span class="hljs-comment">/** Parent context. */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">private</span> ApplicationContext parent;<br><br>	<span class="hljs-comment">/** Environment used by this context. */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">private</span> ConfigurableEnvironment environment;<br><br>	<span class="hljs-comment">/** BeanFactoryPostProcessors to apply on refresh. */</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessors = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>	<span class="hljs-comment">/** System time in milliseconds when this context started. */</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-type">long</span> startupDate;<br><br>	<span class="hljs-comment">/** Flag that indicates whether this context is currently active. */</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicBoolean</span> <span class="hljs-variable">active</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicBoolean</span>();<br><br>	<span class="hljs-comment">/** Flag that indicates whether this context has been closed already. */</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicBoolean</span> <span class="hljs-variable">closed</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicBoolean</span>();<br><br>	<span class="hljs-comment">/** Synchronization monitor for the &quot;refresh&quot; and &quot;destroy&quot;. */</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">startupShutdownMonitor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><br>	<span class="hljs-comment">/** Reference to the JVM shutdown hook, if registered. */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">private</span> Thread shutdownHook;<br><br>	<span class="hljs-comment">/** ResourcePatternResolver used by this context. */</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ResourcePatternResolver resourcePatternResolver;<br><br>	<span class="hljs-comment">/** LifecycleProcessor for managing the lifecycle of beans within this context. */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">private</span> LifecycleProcessor lifecycleProcessor;<br><br>	<span class="hljs-comment">/** MessageSource we delegate our implementation of this interface to. */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">private</span> MessageSource messageSource;<br><br>	<span class="hljs-comment">/** Helper class used in event publishing. */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">private</span> ApplicationEventMulticaster applicationEventMulticaster;<br><br>	<span class="hljs-comment">/** Application startup metrics. **/</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-type">ApplicationStartup</span> <span class="hljs-variable">applicationStartup</span> <span class="hljs-operator">=</span> ApplicationStartup.DEFAULT;<br><br>	<span class="hljs-comment">/** Statically specified listeners. */</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;ApplicationListener&lt;?&gt;&gt; applicationListeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;();<br><br>	<span class="hljs-comment">/** Local listeners registered before refresh. */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">private</span> Set&lt;ApplicationListener&lt;?&gt;&gt; earlyApplicationListeners;<br><br>	<span class="hljs-comment">/** ApplicationEvents published before the multicaster setup. */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">private</span> Set&lt;ApplicationEvent&gt; earlyApplicationEvents;<br>	<br></code></pre></td></tr></table></figure>


<h2 id="refresh"><a href="#refresh" class="headerlink" title="refresh"></a>refresh</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-comment">// spring 初始化最重要的方法</span><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refresh</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException, IllegalStateException &#123;<br>		<span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>.startupShutdownMonitor) &#123;<br>			<span class="hljs-type">StartupStep</span> <span class="hljs-variable">contextRefresh</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.applicationStartup.start(<span class="hljs-string">&quot;spring.context.refresh&quot;</span>);<br><br>			<span class="hljs-comment">// 一、Prepare this context for refreshing.</span><br>			prepareRefresh();<br><br>			<span class="hljs-comment">// 二、Tell the subclass to refresh the internal bean factory.</span><br>      <span class="hljs-comment">// 调用实习 customizeBeanFactory  和 loadBeanDefinition</span><br>			<span class="hljs-type">ConfigurableListableBeanFactory</span> <span class="hljs-variable">beanFactory</span> <span class="hljs-operator">=</span> obtainFreshBeanFactory();<br><br>			<span class="hljs-comment">// 三、Prepare the bean factory for use in this context.</span><br>      <span class="hljs-comment">// 一些需要提前加载的 Bean 注入（或者忽略）到 Spring 容器中</span><br>			prepareBeanFactory(beanFactory);<br><br>			<span class="hljs-keyword">try</span> &#123;<br>				<span class="hljs-comment">// 四、Allows post-processing of the bean factory in context subclasses.</span><br>        <span class="hljs-comment">// 四、运行 注册BeanFactoryProcessor 上下文注册 == 补充context</span><br>				postProcessBeanFactory(beanFactory);<br><br>				<span class="hljs-type">StartupStep</span> <span class="hljs-variable">beanPostProcess</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.applicationStartup.start(<span class="hljs-string">&quot;spring.context.beans.post-process&quot;</span>);<br>				<span class="hljs-comment">// Invoke factory processors registered as beans in the context.</span><br>				invokeBeanFactoryPostProcessors(beanFactory);<br><br>				<span class="hljs-comment">// Register bean processors that intercept bean creation.</span><br>				registerBeanPostProcessors(beanFactory);<br>				beanPostProcess.end();<br><br>				<span class="hljs-comment">// Initialize message source for this context.</span><br>				initMessageSource();<br><br>				<span class="hljs-comment">// Initialize event multicaster for this context.</span><br>				initApplicationEventMulticaster();<br><br>				<span class="hljs-comment">// Initialize other special beans in specific context subclasses.</span><br>				onRefresh();<br><br>				<span class="hljs-comment">// Check for listener beans and register them.</span><br>				registerListeners();<br><br>				<span class="hljs-comment">// Instantiate all remaining (non-lazy-init) singletons.</span><br>        <span class="hljs-comment">// 初始化所有 非懒加载 的bean，容器初始化入口</span><br>				finishBeanFactoryInitialization(beanFactory);<br><br>				<span class="hljs-comment">// Last step: publish corresponding event.</span><br>				finishRefresh();<br>			&#125;<br><br>			<span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br>				<span class="hljs-keyword">if</span> (logger.isWarnEnabled()) &#123;<br>					logger.warn(<span class="hljs-string">&quot;Exception encountered during context initialization - &quot;</span> +<br>							<span class="hljs-string">&quot;cancelling refresh attempt: &quot;</span> + ex);<br>				&#125;<br><br>				<span class="hljs-comment">// Destroy already created singletons to avoid dangling resources.</span><br>				destroyBeans();<br><br>				<span class="hljs-comment">// Reset &#x27;active&#x27; flag.</span><br>				cancelRefresh(ex);<br><br>				<span class="hljs-comment">// Propagate exception to caller.</span><br>				<span class="hljs-keyword">throw</span> ex;<br>			&#125;<br><br>			<span class="hljs-keyword">finally</span> &#123;<br>				<span class="hljs-comment">// Reset common introspection caches in Spring&#x27;s core, since we</span><br>				<span class="hljs-comment">// might not ever need metadata for singleton beans anymore...</span><br>				resetCommonCaches();<br>				contextRefresh.end();<br>			&#125;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="Lifecycle"><a href="#Lifecycle" class="headerlink" title="Lifecycle"></a>Lifecycle</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Lifecycle</span> &#123;<br><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span>;<br><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span>;<br><br><br>	<span class="hljs-type">boolean</span> <span class="hljs-title function_">isRunning</span><span class="hljs-params">()</span>;<br><br>&#125;<br><span class="hljs-comment">// LifecycleProcessor == Lifecycle的加强方法</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">LifecycleProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Lifecycle</span> &#123;<br><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">onRefresh</span><span class="hljs-params">()</span>;<br><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">onClose</span><span class="hljs-params">()</span>;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>



<h3 id="DefaultLifecycleProcessor"><a href="#DefaultLifecycleProcessor" class="headerlink" title="DefaultLifecycleProcessor"></a>DefaultLifecycleProcessor</h3><p>具体方法调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultLifecycleProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">LifecycleProcessor</span>, BeanFactoryAware &#123;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> &#123;<br>     stopBeans();<br>     <span class="hljs-built_in">this</span>.running = <span class="hljs-literal">false</span>;<br>  &#125;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onRefresh</span><span class="hljs-params">()</span> &#123;<br>     startBeans(<span class="hljs-literal">true</span>);<br>     <span class="hljs-built_in">this</span>.running = <span class="hljs-literal">true</span>;<br>  &#125;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClose</span><span class="hljs-params">()</span> &#123;<br>     stopBeans();<br>     <span class="hljs-built_in">this</span>.running = <span class="hljs-literal">false</span>;<br>  &#125;<br>	<span class="hljs-comment">// 调用 bean的start 方法</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startBeans</span><span class="hljs-params">(<span class="hljs-type">boolean</span> autoStartupOnly)</span> &#123;<br>      Map&lt;String, Lifecycle&gt; lifecycleBeans = getLifecycleBeans();<br>      Map&lt;Integer, LifecycleGroup&gt; phases = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeMap</span>&lt;&gt;();<br><br>      lifecycleBeans.forEach((beanName, bean) -&gt; &#123;<br>        <span class="hljs-keyword">if</span> (!autoStartupOnly || (bean <span class="hljs-keyword">instanceof</span> SmartLifecycle smartLifecycle &amp;&amp; smartLifecycle.isAutoStartup())) &#123;<br>          <span class="hljs-type">int</span> <span class="hljs-variable">phase</span> <span class="hljs-operator">=</span> getPhase(bean);<br>          phases.computeIfAbsent(<br>              phase,<br>              p -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">LifecycleGroup</span>(phase, <span class="hljs-built_in">this</span>.timeoutPerShutdownPhase, lifecycleBeans, autoStartupOnly)<br>          ).add(beanName, bean);<br>        &#125;<br>      &#125;); <span class="hljs-comment">// 具体调用</span><br>      <span class="hljs-keyword">if</span> (!phases.isEmpty()) &#123;<br>        phases.values().forEach(LifecycleGroup::start);<br>      &#125;<br>    &#125;<br>	<span class="hljs-comment">// 获取 Lifecycle.class 的子实现类 </span><br>  <span class="hljs-keyword">protected</span> Map&lt;String, Lifecycle&gt; <span class="hljs-title function_">getLifecycleBeans</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-type">ConfigurableListableBeanFactory</span> <span class="hljs-variable">beanFactory</span> <span class="hljs-operator">=</span> getBeanFactory();<br>      Map&lt;String, Lifecycle&gt; beans = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();<br>      String[] beanNames = beanFactory.getBeanNamesForType(Lifecycle.class, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);<br>      <span class="hljs-keyword">for</span> (String beanName : beanNames) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">beanNameToRegister</span> <span class="hljs-operator">=</span> BeanFactoryUtils.transformedBeanName(beanName);<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isFactoryBean</span> <span class="hljs-operator">=</span> beanFactory.isFactoryBean(beanNameToRegister);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">beanNameToCheck</span> <span class="hljs-operator">=</span> (isFactoryBean ? BeanFactory.FACTORY_BEAN_PREFIX + beanName : beanName);<br>        <span class="hljs-keyword">if</span> ((beanFactory.containsSingleton(beanNameToRegister) &amp;&amp;<br>            (!isFactoryBean || matchesBeanType(Lifecycle.class, beanNameToCheck, beanFactory))) ||<br>            matchesBeanType(SmartLifecycle.class, beanNameToCheck, beanFactory)) &#123;<br>          <span class="hljs-type">Object</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> beanFactory.getBean(beanNameToCheck);<br>          <span class="hljs-keyword">if</span> (bean != <span class="hljs-built_in">this</span> &amp;&amp; bean <span class="hljs-keyword">instanceof</span> Lifecycle lifecycle) &#123;<br>            beans.put(beanNameToRegister, lifecycle);<br>          &#125;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">return</span> beans;<br>    &#125;<br>  <br>&#125;<br><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wherezy1/PicGOImageShack/main/images/image-20230730204319825.png" srcset="/img/loading.gif" lazyload alt="image-20230730204319825"></p>
<h1 id="1-3-Refresh"><a href="#1-3-Refresh" class="headerlink" title="1.3 Refresh()"></a>1.3 Refresh()</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refresh</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException, IllegalStateException &#123;<br>    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>.startupShutdownMonitor) &#123;<br>        <span class="hljs-comment">// 准备，记录容器的启动时间startupDate, 标记容器为激活，初始化上下文环境如文件路径信息，验证必填属性是否填写</span><br>        prepareRefresh();<br>        <span class="hljs-comment">// 获取新的beanFactory，销毁原有beanFactory、为每个bean生成BeanDefinition等</span><br>        <span class="hljs-type">ConfigurableListableBeanFactory</span> <span class="hljs-variable">beanFactory</span> <span class="hljs-operator">=</span> obtainFreshBeanFactory();<br>        <span class="hljs-comment">// 初始化beanfactory的各种属性</span><br>        prepareBeanFactory(beanFactory);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 模板方法，此时，所有的beanDefinition已经加载，但是还没有实例化。</span><br>            <span class="hljs-comment">//允许在子类中对beanFactory进行扩展处理。比如添加ware相关接口自动装配设置，添加后置处理器等，是子类扩展prepareBeanFactory(beanFactory)的方法</span><br>            postProcessBeanFactory(beanFactory);<br>            <span class="hljs-comment">// 实例化并调用所有注册的beanFactory后置处理器（实现接口BeanFactoryPostProcessor的bean，在beanFactory标准初始化之后执行）</span><br>            invokeBeanFactoryPostProcessors(beanFactory);<br>            <span class="hljs-comment">// 实例化和注册beanFactory中扩展了BeanPostProcessor的bean</span><br>            <span class="hljs-comment">//例如：</span><br>            <span class="hljs-comment">// AutowiredAnnotationBeanPostProcessor(处理被@Autowired注解修饰的bean并注入)</span><br>            <span class="hljs-comment">// RequiredAnnotationBeanPostProcessor(处理被@Required注解修饰的方法)</span><br>            <span class="hljs-comment">// CommonAnnotationBeanPostProcessor(处理@PreDestroy、@PostConstruct、@Resource等多个注解的作用)等。</span><br>            registerBeanPostProcessors(beanFactory);<br>            <span class="hljs-comment">// Initialize message source for this context.</span><br>            initMessageSource();<br>            <span class="hljs-comment">// Initialize event multicaster for this context.</span><br>            initApplicationEventMulticaster();<br>            <span class="hljs-comment">// 模板方法，在容器刷新的时候可以自定义逻辑，不同的Spring容器做不同的事情。</span><br>            onRefresh();<br>            <span class="hljs-comment">// 注册监听器，广播early application events</span><br>            registerListeners();<br>            <span class="hljs-comment">// 实例化所有剩余的（非懒加载）单例</span><br>            <span class="hljs-comment">// 比如invokeBeanFactoryPostProcessors方法中根据各种注解解析出来的类，在这个时候都会被初始化。</span><br>            <span class="hljs-comment">// 实例化的过程各种BeanPostProcessor开始起作用。</span><br>            finishBeanFactoryInitialization(beanFactory);<br>            <span class="hljs-comment">// refresh做完之后需要做的其他事情。</span><br>            <span class="hljs-comment">// 清除上下文资源缓存（如扫描中的ASM元数据）</span><br>            <span class="hljs-comment">// 初始化上下文的生命周期处理器，并刷新（找出Spring容器中实现了Lifecycle接口的bean并执行start()方法）。</span><br>            <span class="hljs-comment">// 发布ContextRefreshedEvent事件告知对应的ApplicationListener进行响应的操作</span><br>            finishRefresh();<br>        &#125; <span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br>            <span class="hljs-keyword">if</span> (logger.isWarnEnabled()) &#123;<br>                logger.warn(<span class="hljs-string">&quot;Exception encountered during context initialization - &quot;</span> +<br>                        <span class="hljs-string">&quot;cancelling refresh attempt: &quot;</span> + ex);<br>            &#125;<br>            <span class="hljs-comment">// Destroy already created singletons to avoid dangling resources.</span><br>            destroyBeans();<br>            <span class="hljs-comment">// Reset &#x27;active&#x27; flag.</span><br>            cancelRefresh(ex);<br>            <span class="hljs-comment">// Propagate exception to caller.</span><br>            <span class="hljs-keyword">throw</span> ex;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">// Reset common introspection caches in Spring&#x27;s core, since we</span><br>            <span class="hljs-comment">// might not ever need metadata for singleton beans anymore...</span><br>            resetCommonCaches();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>一、</p>
<h2 id="二、obtainFreshBeanFactory"><a href="#二、obtainFreshBeanFactory" class="headerlink" title="二、obtainFreshBeanFactory"></a>二、obtainFreshBeanFactory</h2><p>获取新的 BeanFactory</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// AbstractApplicationContext</span><br><span class="hljs-keyword">protected</span> ConfigurableListableBeanFactory <span class="hljs-title function_">obtainFreshBeanFactory</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-comment">// 调用子类的 refreshBeanFactory 创建 新的BeanFactory</span><br>		<span class="hljs-comment">// customize factory 和  bean definition 加载</span><br>		refreshBeanFactory();<br>		<span class="hljs-comment">// 获取新的（上面刚创建的）beanFactory</span><br>		<span class="hljs-keyword">return</span> getBeanFactory();<br>	&#125;<br><br><br><span class="hljs-comment">// AbstractRefreshableApplicationContext</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractRefreshableApplicationContext</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractApplicationContext</span> &#123;<br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">private</span> Boolean allowBeanDefinitionOverriding;<br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">private</span> Boolean allowCircularReferences;<br><br>	<span class="hljs-comment">/** Bean factory for this context. */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> DefaultListableBeanFactory beanFactory;<br>  <br>  <br>  <span class="hljs-comment">// 刷新工厂</span><br>	<span class="hljs-meta">@Override</span>	<br>	<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refreshBeanFactory</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>		<span class="hljs-keyword">if</span> (hasBeanFactory()) &#123;<br>			destroyBeans();<br>			closeBeanFactory();<br>		&#125;<br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-type">DefaultListableBeanFactory</span> <span class="hljs-variable">beanFactory</span> <span class="hljs-operator">=</span> createBeanFactory();<br>			beanFactory.setSerializationId(getId());<br>			<span class="hljs-comment">// 定制化工厂（暂时不知）</span><br>			customizeBeanFactory(beanFactory);<br>			<span class="hljs-comment">// 加载 BeanDefinition （重点）</span><br>			loadBeanDefinitions(beanFactory);<br>			<span class="hljs-built_in">this</span>.beanFactory = beanFactory;<br>		&#125;<br>		<span class="hljs-keyword">catch</span> (IOException ex) &#123;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationContextException</span>(<span class="hljs-string">&quot;I/O error parsing bean definition source for &quot;</span> + getDisplayName(), ex);<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="三、prepareBeanFactory"><a href="#三、prepareBeanFactory" class="headerlink" title="三、prepareBeanFactory"></a>三、prepareBeanFactory</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Configure the factory&#x27;s standard context characteristics,</span><br><span class="hljs-comment">	 * such as the context&#x27;s ClassLoader and post-processors.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> beanFactory the BeanFactory to configure</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepareBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> &#123;<br>		<span class="hljs-comment">// Tell the internal bean factory to use the context&#x27;s class loader etc.</span><br>		beanFactory.setBeanClassLoader(getClassLoader());<br>		beanFactory.setBeanExpressionResolver(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StandardBeanExpressionResolver</span>(beanFactory.getBeanClassLoader()));<br>		beanFactory.addPropertyEditorRegistrar(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ResourceEditorRegistrar</span>(<span class="hljs-built_in">this</span>, getEnvironment()));<br><br>		<span class="hljs-comment">// Configure the bean factory with context callbacks.</span><br>		beanFactory.addBeanPostProcessor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationContextAwareProcessor</span>(<span class="hljs-built_in">this</span>));<br>		<span class="hljs-comment">// ignoreDependencyInterface是Spring框架中的一个方法，用于在依赖注入过程中忽略指定的接口。</span><br>		<span class="hljs-comment">// 当使用自动装配（autowiring）进行依赖注入时，Spring会尝试将匹配类型的实例注入到依赖项中。但有时候，某些接口可能有多个实现类，而我们只想注入其中的一个实现类。</span><br>		<span class="hljs-comment">// 在这种情况下，可以使用ignoreDependencyInterface方法来告诉Spring忽略指定的接口，不进行自动装配。这样，Spring将会查找其他匹配的实现类进行注入。</span><br>		beanFactory.ignoreDependencyInterface(EnvironmentAware.class);<br>		beanFactory.ignoreDependencyInterface(EmbeddedValueResolverAware.class);<br>		beanFactory.ignoreDependencyInterface(ResourceLoaderAware.class);<br>		beanFactory.ignoreDependencyInterface(ApplicationEventPublisherAware.class);<br>		beanFactory.ignoreDependencyInterface(MessageSourceAware.class);<br>		beanFactory.ignoreDependencyInterface(ApplicationContextAware.class);<br>		beanFactory.ignoreDependencyInterface(ApplicationStartupAware.class);<br><br>		<span class="hljs-comment">// BeanFactory interface not registered as resolvable type in a plain factory.</span><br>		<span class="hljs-comment">// MessageSource registered (and found for autowiring) as a bean.</span><br><br>		<span class="hljs-comment">// registerResolvableDependency是Spring框架中的一个注解，用于将一个可解析的依赖项注册到应用程序上下文中。</span><br>		<span class="hljs-comment">// 通过使用该注解，可以将一个特定类型的依赖项注册为可解析的，</span><br>		<span class="hljs-comment">// 这意味着当Spring容器无法找到该类型的实例时，可以使用注册的可解析依赖项作为默认值。这在某些情况下可以简化依赖注入的配置，提供默认值或占位符。</span><br>		beanFactory.registerResolvableDependency(BeanFactory.class, beanFactory);<br>		beanFactory.registerResolvableDependency(ResourceLoader.class, <span class="hljs-built_in">this</span>);<br>		beanFactory.registerResolvableDependency(ApplicationEventPublisher.class, <span class="hljs-built_in">this</span>);<br>		beanFactory.registerResolvableDependency(ApplicationContext.class, <span class="hljs-built_in">this</span>);<br><br>		<span class="hljs-comment">// Register early post-processor for detecting inner beans as ApplicationListeners.</span><br>		beanFactory.addBeanPostProcessor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationListenerDetector</span>(<span class="hljs-built_in">this</span>));<br><br>		<span class="hljs-comment">// Detect a LoadTimeWeaver and prepare for weaving, if found.</span><br>		<span class="hljs-keyword">if</span> (!NativeDetector.inNativeImage() &amp;&amp; beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) &#123;<br>			beanFactory.addBeanPostProcessor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoadTimeWeaverAwareProcessor</span>(beanFactory));<br>			<span class="hljs-comment">// Set a temporary ClassLoader for type matching.</span><br>			beanFactory.setTempClassLoader(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ContextTypeMatchClassLoader</span>(beanFactory.getBeanClassLoader()));<br>		&#125;<br><br>		<span class="hljs-comment">// Register default environment beans.</span><br>		<span class="hljs-keyword">if</span> (!beanFactory.containsLocalBean(ENVIRONMENT_BEAN_NAME)) &#123;<br>			beanFactory.registerSingleton(ENVIRONMENT_BEAN_NAME, getEnvironment());<br>		&#125; <span class="hljs-comment">// 获取系统的 properties参数 beanname,map</span><br>		<span class="hljs-keyword">if</span> (!beanFactory.containsLocalBean(SYSTEM_PROPERTIES_BEAN_NAME)) &#123;<br>			beanFactory.registerSingleton(SYSTEM_PROPERTIES_BEAN_NAME, getEnvironment().getSystemProperties());<br>		&#125; <span class="hljs-comment">// 获取系统环境参数 beanname, map</span><br>		<span class="hljs-keyword">if</span> (!beanFactory.containsLocalBean(SYSTEM_ENVIRONMENT_BEAN_NAME)) &#123;<br>			beanFactory.registerSingleton(SYSTEM_ENVIRONMENT_BEAN_NAME, getEnvironment().getSystemEnvironment());<br>		&#125;<br>		<span class="hljs-keyword">if</span> (!beanFactory.containsLocalBean(APPLICATION_STARTUP_BEAN_NAME)) &#123;<br>			beanFactory.registerSingleton(APPLICATION_STARTUP_BEAN_NAME, getApplicationStartup());<br>		&#125;<br>	&#125;<br></code></pre></td></tr></table></figure>





<h2 id="四、postProcessBeanFactory"><a href="#四、postProcessBeanFactory" class="headerlink" title="四、postProcessBeanFactory"></a>四、postProcessBeanFactory</h2><p>子类 在 context 中注册 BeanFactoryProcess，或者其他 增强逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 在context标准初始化之后，内部定义资源将被加载；</span><br>	<span class="hljs-comment">// 但是没有 增加器将运行，没有bean被注册，没有bean被实例化</span><br>	<span class="hljs-comment">// 允许注册（子类context）特殊的 BeanPostProcessors</span><br>	<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> &#123;<br>	&#125;<br><br><br><span class="hljs-comment">// 子类 context</span><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Register ServletContextAwareProcessor.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> ServletContextAwareProcessor</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> &#123;<br>		beanFactory.addBeanPostProcessor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WebApplicationContextServletContextAwareProcessor</span>(<span class="hljs-built_in">this</span>));<br>		beanFactory.ignoreDependencyInterface(ServletContextAware.class);<br>		registerWebApplicationScopes();<br>	&#125;<br><br><br></code></pre></td></tr></table></figure>





<h3 id="GenericWebApplicationContext"><a href="#GenericWebApplicationContext" class="headerlink" title="GenericWebApplicationContext"></a>GenericWebApplicationContext</h3><p>父类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> &#123;<br>   <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.servletContext != <span class="hljs-literal">null</span>) &#123;<br>      beanFactory.addBeanPostProcessor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletContextAwareProcessor</span>(<span class="hljs-built_in">this</span>.servletContext));<br>      beanFactory.ignoreDependencyInterface(ServletContextAware.class);<br>   &#125;<br>   WebApplicationContextUtils.registerWebApplicationScopes(beanFactory, <span class="hljs-built_in">this</span>.servletContext);<br>   WebApplicationContextUtils.registerEnvironmentBeans(beanFactory, <span class="hljs-built_in">this</span>.servletContext);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>子类：ServletWebServerApplicationContext</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> &#123;<br>   beanFactory.addBeanPostProcessor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WebApplicationContextServletContextAwareProcessor</span>(<span class="hljs-built_in">this</span>));<br>   beanFactory.ignoreDependencyInterface(ServletContextAware.class);<br>   registerWebApplicationScopes();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>子子类：AnnotationConfigServletWebServerApplicationContext</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotationConfigServletWebServerApplicationContext</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServletWebServerApplicationContext</span><br>		<span class="hljs-keyword">implements</span> <span class="hljs-title class_">AnnotationConfigRegistry</span> &#123;<br><br><span class="hljs-comment">// 业务逻辑增强：扫描包路径、注册</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AnnotatedBeanDefinitionReader reader;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ClassPathBeanDefinitionScanner scanner;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;Class&lt;?&gt;&gt; annotatedClasses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;();<br><br><span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> &#123;<br>		<span class="hljs-built_in">super</span>.postProcessBeanFactory(beanFactory);<br>		<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.basePackages != <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-built_in">this</span>.basePackages.length &gt; <span class="hljs-number">0</span>) &#123;<br>			<span class="hljs-built_in">this</span>.scanner.scan(<span class="hljs-built_in">this</span>.basePackages);<br>		&#125;<br>		<span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.annotatedClasses.isEmpty()) &#123;<br>			<span class="hljs-built_in">this</span>.reader.register(ClassUtils.toClassArray(<span class="hljs-built_in">this</span>.annotatedClasses));<br>		&#125;<br>	&#125;<br></code></pre></td></tr></table></figure>





<h2 id="五、invokeBeanFactoryPostProcessors"><a href="#五、invokeBeanFactoryPostProcessors" class="headerlink" title="五、invokeBeanFactoryPostProcessors"></a>五、invokeBeanFactoryPostProcessors</h2><p>执行 Bean Factory 增强器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invokeBeanFactoryPostProcessors</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> &#123;<br>   <span class="hljs-comment">// PostProcessorRegistrationDelegate ## 重要方法 ## 执行 BeanFactoryPostProcessors ## postProcessBeanFactory()</span><br>   <span class="hljs-comment">// BeanFactory 增加方法 （最重要：ConfigurationClassPostProcessor）</span><br>   PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());<br><br>   <span class="hljs-comment">// Detect a LoadTimeWeaver and prepare for weaving, if found in the meantime</span><br>   <span class="hljs-comment">// (e.g. through an @Bean method registered by ConfigurationClassPostProcessor)</span><br>   <span class="hljs-keyword">if</span> (!NativeDetector.inNativeImage() &amp;&amp; beanFactory.getTempClassLoader() == <span class="hljs-literal">null</span> &amp;&amp; beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) &#123;<br>      beanFactory.addBeanPostProcessor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoadTimeWeaverAwareProcessor</span>(beanFactory));<br>      beanFactory.setTempClassLoader(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ContextTypeMatchClassLoader</span>(beanFactory.getBeanClassLoader()));<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="六、registerBeanPostProcessors"><a href="#六、registerBeanPostProcessors" class="headerlink" title="六、registerBeanPostProcessors"></a>六、registerBeanPostProcessors</h2><p>注册Bean 的增强器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerBeanPostProcessors</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> &#123;<br>		PostProcessorRegistrationDelegate.registerBeanPostProcessors(beanFactory, <span class="hljs-built_in">this</span>);<br>	&#125;<br></code></pre></td></tr></table></figure>





<h1 id="1-3-AnnotationConfigApplicationContext"><a href="#1-3-AnnotationConfigApplicationContext" class="headerlink" title="1.3 AnnotationConfigApplicationContext"></a>1.3 AnnotationConfigApplicationContext</h1><p>注册Bean </p>
<p><strong>AnnotatedBeanDefinitionReader  &#x2F;&#x2F; ClassPathBeanDefinitionScanner</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">独立的应用程序上下文，接受 组件类 作为输入 — 特别是 @Configuration带注释的类，但也接受使用注释的普通 @Component 类型和符合 JSR-330 的 javax.inject 类。</span><br><span class="hljs-comment">允许使用 逐个注册类，也允许使用 scan(String...)进行register(Class...)类路径扫描。</span><br><span class="hljs-comment">在有多个 @Configuration 类的情况下， @Bean 后面类中定义的方法将覆盖前面类中定义的方法。可以利用这一点，通过额外的 @Configuration 类故意覆盖某些 Bean 定义。</span><br><span class="hljs-comment">有关使用示例，请参见 @Configuration的 javadoc。</span><br><span class="hljs-comment">因为：</span><br><span class="hljs-comment">3.0</span><br><span class="hljs-comment">另请参阅：</span><br><span class="hljs-comment">register, scan, AnnotatedBeanDefinitionReader, ClassPathBeanDefinitionScanner, org.springframework.context.support.GenericXmlApplicationContext</span><br><span class="hljs-comment">作者：</span><br><span class="hljs-comment">尤尔根·霍勒，克里斯·比姆斯*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">GenericApplicationContext</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AnnotationConfigRegistry</span> &#123;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AnnotatedBeanDefinitionReader reader;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ClassPathBeanDefinitionScanner scanner;<br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">AnnotationConfigApplicationContext</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-type">StartupStep</span> <span class="hljs-variable">createAnnotatedBeanDefReader</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getApplicationStartup().start(<span class="hljs-string">&quot;spring.context.annotated-bean-reader.create&quot;</span>);<br>		<span class="hljs-built_in">this</span>.reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotatedBeanDefinitionReader</span>(<span class="hljs-built_in">this</span>);<br>		createAnnotatedBeanDefReader.end();<br>		<span class="hljs-built_in">this</span>.scanner = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathBeanDefinitionScanner</span>(<span class="hljs-built_in">this</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="1-3-1-AnnotatedBeanDefinitionReader"><a href="#1-3-1-AnnotatedBeanDefinitionReader" class="headerlink" title="1.3.1 AnnotatedBeanDefinitionReader"></a>1.3.1 AnnotatedBeanDefinitionReader</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotatedBeanDefinitionReader</span> &#123;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BeanDefinitionRegistry registry;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">BeanNameGenerator</span> <span class="hljs-variable">beanNameGenerator</span> <span class="hljs-operator">=</span> AnnotationBeanNameGenerator.INSTANCE;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">ScopeMetadataResolver</span> <span class="hljs-variable">scopeMetadataResolver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationScopeMetadataResolver</span>();<br><br>   <span class="hljs-keyword">private</span> ConditionEvaluator conditionEvaluator;<br><br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Create a new &#123;<span class="hljs-doctag">@code</span> AnnotatedBeanDefinitionReader&#125; for the given registry.</span><br><span class="hljs-comment">    * &lt;p&gt;If the registry is &#123;<span class="hljs-doctag">@link</span> EnvironmentCapable&#125;, e.g. is an &#123;<span class="hljs-doctag">@code</span> ApplicationContext&#125;,</span><br><span class="hljs-comment">    * the &#123;<span class="hljs-doctag">@link</span> Environment&#125; will be inherited, otherwise a new</span><br><span class="hljs-comment">    * &#123;<span class="hljs-doctag">@link</span> StandardEnvironment&#125; will be created and used.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> registry the &#123;<span class="hljs-doctag">@code</span> BeanFactory&#125; to load bean definitions into,</span><br><span class="hljs-comment">    * in the form of a &#123;<span class="hljs-doctag">@code</span> BeanDefinitionRegistry&#125;</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@see</span> #AnnotatedBeanDefinitionReader(BeanDefinitionRegistry, Environment)</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@see</span> #setEnvironment(Environment)</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">AnnotatedBeanDefinitionReader</span><span class="hljs-params">(BeanDefinitionRegistry registry)</span> &#123;<br>      <span class="hljs-built_in">this</span>(registry, getOrCreateEnvironment(registry));<br>   &#125;<br>  <br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">AnnotatedBeanDefinitionReader</span><span class="hljs-params">(BeanDefinitionRegistry registry, Environment environment)</span> &#123;<br>		Assert.notNull(registry, <span class="hljs-string">&quot;BeanDefinitionRegistry must not be null&quot;</span>);<br>		Assert.notNull(environment, <span class="hljs-string">&quot;Environment must not be null&quot;</span>);<br>		<span class="hljs-built_in">this</span>.registry = registry;<br>		<span class="hljs-built_in">this</span>.conditionEvaluator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConditionEvaluator</span>(registry, environment, <span class="hljs-literal">null</span>);<br>		AnnotationConfigUtils.registerAnnotationConfigProcessors(<span class="hljs-built_in">this</span>.registry);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="1-3-2-ClassPathBeanDefinitionScanner"><a href="#1-3-2-ClassPathBeanDefinitionScanner" class="headerlink" title="1.3.2 ClassPathBeanDefinitionScanner"></a>1.3.2 ClassPathBeanDefinitionScanner</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java">```<br><br><br><br><br><br># <span class="hljs-number">1.4</span> even模块<br><br>事件<br><br>监听<br><br>广播<br><br>注解<br><br><br><br><br><br># <span class="hljs-number">1.5</span> Import<br><br><br><br>## <span class="hljs-number">1.5</span><span class="hljs-number">.1</span> ImportSelector<br><br><br><br>```java<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ImportSelector</span> &#123;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Select and return the names of which class(es) should be imported based on</span><br><span class="hljs-comment">    * the &#123;<span class="hljs-doctag">@link</span> AnnotationMetadata&#125; of the importing @&#123;<span class="hljs-doctag">@link</span> Configuration&#125; class.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> the class names, or an empty array if none</span><br><span class="hljs-comment">    */</span><br>   String[] selectImports(AnnotationMetadata importingClassMetadata);<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Return a predicate for excluding classes from the import candidates, to be</span><br><span class="hljs-comment">    * transitively applied to all classes found through this selector&#x27;s imports.</span><br><span class="hljs-comment">    * &lt;p&gt;If this predicate returns &#123;<span class="hljs-doctag">@code</span> true&#125; for a given fully-qualified</span><br><span class="hljs-comment">    * class name, said class will not be considered as an imported configuration</span><br><span class="hljs-comment">    * class, bypassing class file loading as well as metadata introspection.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> the filter predicate for fully-qualified candidate class names</span><br><span class="hljs-comment">    * of transitively imported configuration classes, or &#123;<span class="hljs-doctag">@code</span> null&#125; if none</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@since</span> 5.2.4</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Nullable</span><br>   <span class="hljs-keyword">default</span> Predicate&lt;String&gt; <span class="hljs-title function_">getExclusionFilter</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>







<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 被 ConfigurationClassParser 调用 Import </span><br><span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;<br>		<span class="hljs-keyword">if</span> (!isEnabled(annotationMetadata)) &#123;<br>			<span class="hljs-keyword">return</span> NO_IMPORTS;<br>		&#125; <span class="hljs-comment">// 从spring.factories 获取需要被自动注册的 类的全路径</span><br>		<span class="hljs-type">AutoConfigurationEntry</span> <span class="hljs-variable">autoConfigurationEntry</span> <span class="hljs-operator">=</span> getAutoConfigurationEntry(annotationMetadata);<br>		<span class="hljs-keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());<br>	&#125;<br><span class="hljs-comment">// 判断是否开启自动注入的配置</span><br><span class="hljs-comment">// String ENABLED_OVERRIDE_PROPERTY = &quot;spring.boot.enableautoconfiguration&quot;;</span><br><span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEnabled</span><span class="hljs-params">(AnnotationMetadata metadata)</span> &#123;<br>		<span class="hljs-keyword">if</span> (getClass() == AutoConfigurationImportSelector.class) &#123;<br>			<span class="hljs-keyword">return</span> getEnvironment().getProperty(EnableAutoConfiguration.ENABLED_OVERRIDE_PROPERTY, Boolean.class, <span class="hljs-literal">true</span>);<br>		&#125;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>	&#125;<br><br><br><span class="hljs-keyword">protected</span> AutoConfigurationEntry <span class="hljs-title function_">getAutoConfigurationEntry</span><span class="hljs-params">(AnnotationMetadata annotationMetadata)</span> &#123;<br>   <span class="hljs-comment">// 判断是否开启自动配置</span><br>   <span class="hljs-keyword">if</span> (!isEnabled(annotationMetadata)) &#123;<br>      <span class="hljs-keyword">return</span> EMPTY_ENTRY;<br>   &#125;<br>   <span class="hljs-comment">// 获取@EnableAutoConfiguration注解的属性</span><br>   <span class="hljs-type">AnnotationAttributes</span> <span class="hljs-variable">attributes</span> <span class="hljs-operator">=</span> getAttributes(annotationMetadata);<br>   <span class="hljs-comment">// 从spring.factories文件中获取配置类的全限定名数组</span><br>   List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);<br>   <span class="hljs-comment">// 去重</span><br>   configurations = removeDuplicates(configurations);<br>   <span class="hljs-comment">// 获取注解中exclude或excludeName排除的类集合</span><br>   Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);<br>   <span class="hljs-comment">// 检查被排除类是否可以实例化，是否被自动配置所使用，否则抛出异常</span><br>   checkExcludedClasses(configurations, exclusions);<br>   <span class="hljs-comment">// 去除被排除的类</span><br>   configurations.removeAll(exclusions);<br>   <span class="hljs-comment">// 使用spring.factories配置文件中配置的过滤器对自动配置类进行过滤</span><br>   configurations = getConfigurationClassFilter().filter(configurations);<br>   <span class="hljs-comment">// 抛出事件</span><br>   fireAutoConfigurationImportEvents(configurations, exclusions);<br>   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AutoConfigurationEntry</span>(configurations, exclusions);<br>&#125;<br><br></code></pre></td></tr></table></figure>





<h1 id="第二部分-Spring-Bean"><a href="#第二部分-Spring-Bean" class="headerlink" title="第二部分 Spring Bean"></a>第二部分 Spring Bean</h1><h1 id="BeanFactory"><a href="#BeanFactory" class="headerlink" title="BeanFactory"></a>BeanFactory</h1><p>定义 获取Bean的 接口，bean工厂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanFactory</span> &#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Used to dereference a &#123;<span class="hljs-doctag">@link</span> FactoryBean&#125; instance and distinguish it from</span><br><span class="hljs-comment">	 * beans &lt;i&gt;created&lt;/i&gt; by the FactoryBean. For example, if the bean named</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@code</span> myJndiObject&#125; is a FactoryBean, getting &#123;<span class="hljs-doctag">@code</span> &amp;myJndiObject&#125;</span><br><span class="hljs-comment">	 * will return the factory, not the instance returned by the factory.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-type">String</span> <span class="hljs-variable">FACTORY_BEAN_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&amp;&quot;</span>;<br><br>	Object <span class="hljs-title function_">getBean</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> BeansException;<br><br><br>	&lt;T&gt; T <span class="hljs-title function_">getBean</span><span class="hljs-params">(String name, Class&lt;T&gt; requiredType)</span> <span class="hljs-keyword">throws</span> BeansException;<br><br>	Object <span class="hljs-title function_">getBean</span><span class="hljs-params">(String name, Object... args)</span> <span class="hljs-keyword">throws</span> BeansException;<br><br>	&lt;T&gt; T <span class="hljs-title function_">getBean</span><span class="hljs-params">(Class&lt;T&gt; requiredType)</span> <span class="hljs-keyword">throws</span> BeansException;<br><br><br>	&lt;T&gt; ObjectProvider&lt;T&gt; <span class="hljs-title function_">getBeanProvider</span><span class="hljs-params">(Class&lt;T&gt; requiredType)</span>;<br><br>	&lt;T&gt; ObjectProvider&lt;T&gt; <span class="hljs-title function_">getBeanProvider</span><span class="hljs-params">(ResolvableType requiredType)</span>;<br><br>	<span class="hljs-type">boolean</span> <span class="hljs-title function_">containsBean</span><span class="hljs-params">(String name)</span>;<br><br>	<span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>	<span class="hljs-type">boolean</span> <span class="hljs-title function_">isPrototype</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>	<span class="hljs-type">boolean</span> <span class="hljs-title function_">isTypeMatch</span><span class="hljs-params">(String name, ResolvableType typeToMatch)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>	<span class="hljs-type">boolean</span> <span class="hljs-title function_">isTypeMatch</span><span class="hljs-params">(String name, Class&lt;?&gt; typeToMatch)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>	<span class="hljs-meta">@Nullable</span><br>	Class&lt;?&gt; getType(String name) <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>	<span class="hljs-meta">@Nullable</span><br>	Class&lt;?&gt; getType(String name, <span class="hljs-type">boolean</span> allowFactoryBeanInit) <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>	String[] getAliases(String name);<br><br>&#125;<br><br></code></pre></td></tr></table></figure>



<h1 id="《-增强器-Processor》"><a href="#《-增强器-Processor》" class="headerlink" title="《 增强器 Processor》"></a>《 增强器 Processor》</h1><h1 id="2-1-BeanFactoryPostProcessor"><a href="#2-1-BeanFactoryPostProcessor" class="headerlink" title="2.1 BeanFactoryPostProcessor"></a>2.1 BeanFactoryPostProcessor</h1><p>用于 BeanFactory的增强：包括获取 bean</p>
<p><img src="https://raw.githubusercontent.com/wherezy1/PicGOImageShack/main/images/image-20230730223204903.png" srcset="/img/loading.gif" lazyload alt="image-20230730223204903"></p>
<p>用于 Spring 整个过程初始化过程的增强</p>
<ol start="3">
<li>BeanFactoryPostProcessor：它也可以被视为一种增强子接口。<br>BeanFactoryPostProcessor在Bean工厂实例化Bean之前对Bean工厂进行修改，可以用于添加、修改或删除Bean定义。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanFactoryPostProcessor</span> &#123;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Modify the application context&#x27;s internal bean factory after its standard</span><br><span class="hljs-comment">    * initialization. All bean definitions will have been loaded, but no beans</span><br><span class="hljs-comment">    * will have been instantiated yet. This allows for overriding or adding</span><br><span class="hljs-comment">    * properties even to eager-initializing beans.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> beanFactory the bean factory used by the application context</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> org.springframework.beans.BeansException in case of errors</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>具体实现类作用</p>
<figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs nim"><span class="hljs-type">BeanFactoryPostProcessor</span>接口是<span class="hljs-type">Spring</span>框架中的一个扩展点，用于在<span class="hljs-type">Bean</span>工厂实例化<span class="hljs-type">Bean</span>之前对<span class="hljs-type">Bean</span>工厂进行修改。通过实现<span class="hljs-type">BeanFactoryPostProcessor</span>接口，可以对<span class="hljs-type">Bean</span>定义进行修改、添加新的<span class="hljs-type">Bean</span>定义或者对<span class="hljs-type">Bean</span>工厂进行其他自定义操作，以达到增强效果。<br><br>以下是一些常见的实现<span class="hljs-type">BeanFactoryPostProcessor</span>接口的类，以及它们的主要用途：<br><br><span class="hljs-number">1</span>. <span class="hljs-type">PropertySourcesPlaceholderConfigurer</span>：这是<span class="hljs-type">Spring</span>框架内置的一个实现类，用于处理属性占位符（如$<span class="hljs-meta">&#123;...&#125;</span>）的解析和替换。它可以读取配置文件中的属性值，并将其解析为<span class="hljs-type">Bean</span>定义，然后注册到<span class="hljs-type">Bean</span>工厂中。<br><br><span class="hljs-number">2</span>. <span class="hljs-type">ConfigurationClassPostProcessor</span>：这是<span class="hljs-type">Spring</span>框架内置的一个实现类，用于处理@<span class="hljs-type">Configuration</span>注解标记的配置类。它会扫描配置类中的@<span class="hljs-type">Bean</span>注解，将其解析为<span class="hljs-type">Bean</span>定义，并注册到<span class="hljs-type">Bean</span>工厂中。<br><br><span class="hljs-number">3</span>. <span class="hljs-type">AutowiredAnnotationBeanPostProcessor</span>：这是<span class="hljs-type">Spring</span>框架内置的一个实现类，用于处理@<span class="hljs-type">Autowired</span>和@<span class="hljs-type">Resource</span>等注解的解析和处理。它会在<span class="hljs-type">Bean</span>实例化之后，对带有这些注解的字段或方法进行依赖注入。<br><br><span class="hljs-number">4</span>. <span class="hljs-type">BeanDefinitionRegistryPostProcessor</span>：虽然不是直接实现<span class="hljs-type">BeanFactoryPostProcessor</span>接口，但是实现了<span class="hljs-type">BeanDefinitionRegistryPostProcessor</span>接口的类也可以对<span class="hljs-type">Bean</span>定义进行修改或添加。它在<span class="hljs-type">Bean</span>定义注册过程中被调用，可以动态地注册额外的<span class="hljs-type">Bean</span>定义。<br><br>这些实现类的主要用途是在<span class="hljs-type">Spring</span>容器启动时对<span class="hljs-type">Bean</span>工厂进行修改，以满足特定的需求。例如，通过<span class="hljs-type">PropertySourcesPlaceholderConfigurer</span>可以实现属性占位符的解析和替换，通过<span class="hljs-type">ConfigurationClassPostProcessor</span>可以处理@<span class="hljs-type">Configuration</span>注解标记的配置类，通过<span class="hljs-type">AutowiredAnnotationBeanPostProcessor</span>可以实现依赖注入等。<br><br>需要注意的是，<span class="hljs-type">BeanFactoryPostProcessor</span>接口的实现类在<span class="hljs-type">Spring</span>容器启动时会被自动检测并执行。它们可以通过实现<span class="hljs-type">Ordered</span>接口或使用@<span class="hljs-type">Order</span>注解来指定执行的顺序。<br><br></code></pre></td></tr></table></figure>





<h2 id="2-1-1-BeanDefinitionRegistryPostProcessor"><a href="#2-1-1-BeanDefinitionRegistryPostProcessor" class="headerlink" title="2.1.1 BeanDefinitionRegistryPostProcessor"></a>2.1.1 BeanDefinitionRegistryPostProcessor</h2><p>用于增强 BeanDefinition 的注册，也是获取Bean 的增强</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanDefinitionRegistryPostProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BeanFactoryPostProcessor</span> &#123;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Modify the application context&#x27;s internal bean definition registry after its</span><br><span class="hljs-comment">    * standard initialization. All regular bean definitions will have been loaded,</span><br><span class="hljs-comment">    * but no beans will have been instantiated yet. This allows for adding further</span><br><span class="hljs-comment">    * bean definitions before the next post-processing phase kicks in.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> registry the bean definition registry used by the application context</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> org.springframework.beans.BeansException in case of errors</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanDefinitionRegistry</span><span class="hljs-params">(BeanDefinitionRegistry registry)</span> <span class="hljs-keyword">throws</span> BeansException;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>BeanDefinitionRegistryPostProcessor 如何生效</p>
<figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs nim"><span class="hljs-type">BeanDefinitionRegistryPostProcessor</span>接口是<span class="hljs-type">Spring</span>框架中的一个扩展点，用于在<span class="hljs-type">Bean</span>定义注册过程中对<span class="hljs-type">Bean</span>定义进行修改或添加新的<span class="hljs-type">Bean</span>定义。它的实现类可以通过自定义编写或使用<span class="hljs-type">Spring</span>提供的一些内置实现类来实现。<br><br>以下是一些常见的实现<span class="hljs-type">BeanDefinitionRegistryPostProcessor</span>接口的类：<br><br><span class="hljs-number">1</span>. <span class="hljs-type">ConfigurationClassPostProcessor</span>：这是<span class="hljs-type">Spring</span>框架内置的一个实现类，用于处理@<span class="hljs-type">Configuration</span>注解标记的配置类。它会扫描配置类中的@<span class="hljs-type">Bean</span>注解，将其解析为<span class="hljs-type">Bean</span>定义，并注册到<span class="hljs-type">Bean</span>工厂中。<br><br><span class="hljs-number">2</span>. <span class="hljs-type">PropertySourcesPlaceholderConfigurer</span>：这是<span class="hljs-type">Spring</span>框架内置的一个实现类，用于处理属性占位符（如$<span class="hljs-meta">&#123;...&#125;</span>）的解析和替换。它会读取配置文件中的属性值，并将其解析为<span class="hljs-type">Bean</span>定义，然后注册到<span class="hljs-type">Bean</span>工厂中。<br><br><span class="hljs-number">3</span>. <span class="hljs-type">ImportBeanDefinitionRegistrar</span>：这是一个接口，用于通过编程方式注册<span class="hljs-type">Bean</span>定义。实现该接口的类可以在<span class="hljs-type">Bean</span>定义注册过程中动态地注册额外的<span class="hljs-type">Bean</span>定义。<br><br><span class="hljs-number">4</span>. <span class="hljs-type">BeanFactoryPostProcessor</span>：虽然不是直接实现<span class="hljs-type">BeanDefinitionRegistryPostProcessor</span>接口，但是实现了<span class="hljs-type">BeanFactoryPostProcessor</span>接口的类也可以对<span class="hljs-type">Bean</span>定义进行修改或添加。<span class="hljs-type">BeanFactoryPostProcessor</span>是另一个扩展点，用于在<span class="hljs-type">Bean</span>工厂实例化<span class="hljs-type">Bean</span>之前对<span class="hljs-type">Bean</span>工厂进行修改。<br><br>需要注意的是，<span class="hljs-type">BeanDefinitionRegistryPostProcessor</span>接口的实现类在<span class="hljs-type">Spring</span>容器启动时会被自动检测并执行。它们可以通过实现<span class="hljs-type">Ordered</span>接口或使用@<span class="hljs-type">Order</span>注解来指定执行的顺序。<br></code></pre></td></tr></table></figure>











<h1 id="2-1-2-ConfigurationClassPostProcessor"><a href="#2-1-2-ConfigurationClassPostProcessor" class="headerlink" title="2.1.2 ConfigurationClassPostProcessor"></a>2.1.2 ConfigurationClassPostProcessor</h1><p>配置类、@Component 、@Import 等注解 的扫描</p>
<h2 id="注册-x2F-调用执行"><a href="#注册-x2F-调用执行" class="headerlink" title="注册 &#x2F; 调用执行"></a>注册 &#x2F; 调用执行</h2><h3 id="注册为BeanDefinition"><a href="#注册为BeanDefinition" class="headerlink" title="注册为BeanDefinition"></a>注册为BeanDefinition</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotatedBeanDefinitionReader</span> &#123;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BeanDefinitionRegistry registry;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-type">BeanNameGenerator</span> <span class="hljs-variable">beanNameGenerator</span> <span class="hljs-operator">=</span> AnnotationBeanNameGenerator.INSTANCE;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-type">ScopeMetadataResolver</span> <span class="hljs-variable">scopeMetadataResolver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationScopeMetadataResolver</span>();<br><br>	<span class="hljs-keyword">private</span> ConditionEvaluator conditionEvaluator;<br>  <br><span class="hljs-keyword">public</span> <span class="hljs-title function_">AnnotatedBeanDefinitionReader</span><span class="hljs-params">(BeanDefinitionRegistry registry, Environment environment)</span> &#123;<br>		Assert.notNull(registry, <span class="hljs-string">&quot;BeanDefinitionRegistry must not be null&quot;</span>);<br>		Assert.notNull(environment, <span class="hljs-string">&quot;Environment must not be null&quot;</span>);<br>		<span class="hljs-built_in">this</span>.registry = registry;<br>		<span class="hljs-built_in">this</span>.conditionEvaluator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConditionEvaluator</span>(registry, environment, <span class="hljs-literal">null</span>);<br>		AnnotationConfigUtils.registerAnnotationConfigProcessors(<span class="hljs-built_in">this</span>.registry);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="AnnotationConfigUtils"><a href="#AnnotationConfigUtils" class="headerlink" title="AnnotationConfigUtils"></a>AnnotationConfigUtils</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotationConfigUtils</span> &#123;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Register all relevant annotation post processors in the given registry.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> registry the registry to operate on</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> source the configuration source element (already extracted)</span><br><span class="hljs-comment"> * that this registration was triggered from. May be &#123;<span class="hljs-doctag">@code</span> null&#125;.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> a Set of BeanDefinitionHolders, containing all bean definitions</span><br><span class="hljs-comment"> * that have actually been registered by this call</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Set&lt;BeanDefinitionHolder&gt; <span class="hljs-title function_">registerAnnotationConfigProcessors</span><span class="hljs-params">(</span><br><span class="hljs-params">      BeanDefinitionRegistry registry, <span class="hljs-meta">@Nullable</span> Object source)</span> &#123;<br><br>   <span class="hljs-type">DefaultListableBeanFactory</span> <span class="hljs-variable">beanFactory</span> <span class="hljs-operator">=</span> unwrapDefaultListableBeanFactory(registry);<br>   <span class="hljs-keyword">if</span> (beanFactory != <span class="hljs-literal">null</span>) &#123;<br>     <span class="hljs-comment">// AnnotationAwareOrderComparator</span><br>      <span class="hljs-keyword">if</span> (!(beanFactory.getDependencyComparator() <span class="hljs-keyword">instanceof</span> AnnotationAwareOrderComparator)) &#123;<br>         beanFactory.setDependencyComparator(AnnotationAwareOrderComparator.INSTANCE);<br>      &#125;<br>      <span class="hljs-keyword">if</span> (!(beanFactory.getAutowireCandidateResolver() <span class="hljs-keyword">instanceof</span> ContextAnnotationAutowireCandidateResolver)) &#123;<br>        <span class="hljs-comment">// ContextAnnotationAutowireCandidateResolver</span><br>         beanFactory.setAutowireCandidateResolver(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ContextAnnotationAutowireCandidateResolver</span>());<br>      &#125;<br>   &#125;<br><br>   Set&lt;BeanDefinitionHolder&gt; beanDefs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;(<span class="hljs-number">8</span>);<br><br>   <span class="hljs-keyword">if</span> (!registry.containsBeanDefinition(CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;<br>     <span class="hljs-comment">// 11111、、、ConfigurationClassPostProcessor 注册为 RootBeanDefinition</span><br>      <span class="hljs-type">RootBeanDefinition</span> <span class="hljs-variable">def</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RootBeanDefinition</span>(ConfigurationClassPostProcessor.class);<br>      def.setSource(source);<br>      beanDefs.add(registerPostProcessor(registry, def, CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME));<br>   &#125;<br><br>   <span class="hljs-keyword">if</span> (!registry.containsBeanDefinition(AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;<br>      <span class="hljs-type">RootBeanDefinition</span> <span class="hljs-variable">def</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RootBeanDefinition</span>(AutowiredAnnotationBeanPostProcessor.class);<br>      def.setSource(source);<br>      beanDefs.add(registerPostProcessor(registry, def, AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME));<br>   &#125;<br><br>   <span class="hljs-comment">// Check for JSR-250 support, and if present add the CommonAnnotationBeanPostProcessor.</span><br>   <span class="hljs-keyword">if</span> (jsr250Present &amp;&amp; !registry.containsBeanDefinition(COMMON_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;<br>      <span class="hljs-type">RootBeanDefinition</span> <span class="hljs-variable">def</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RootBeanDefinition</span>(CommonAnnotationBeanPostProcessor.class);<br>      def.setSource(source);<br>      beanDefs.add(registerPostProcessor(registry, def, COMMON_ANNOTATION_PROCESSOR_BEAN_NAME));<br>   &#125;<br><br>   <span class="hljs-comment">// Check for JPA support, and if present add the PersistenceAnnotationBeanPostProcessor.</span><br>   <span class="hljs-keyword">if</span> (jpaPresent &amp;&amp; !registry.containsBeanDefinition(PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;<br>      <span class="hljs-type">RootBeanDefinition</span> <span class="hljs-variable">def</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RootBeanDefinition</span>();<br>      <span class="hljs-keyword">try</span> &#123;<br>         def.setBeanClass(ClassUtils.forName(PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME,<br>               AnnotationConfigUtils.class.getClassLoader()));<br>      &#125;<br>      <span class="hljs-keyword">catch</span> (ClassNotFoundException ex) &#123;<br>         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<br>               <span class="hljs-string">&quot;Cannot load optional framework class: &quot;</span> + PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME, ex);<br>      &#125;<br>      def.setSource(source);<br>      beanDefs.add(registerPostProcessor(registry, def, PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME));<br>   &#125;<br>		<span class="hljs-comment">//EventListenerMethodProcessor</span><br>   <span class="hljs-keyword">if</span> (!registry.containsBeanDefinition(EVENT_LISTENER_PROCESSOR_BEAN_NAME)) &#123;<br>      <span class="hljs-type">RootBeanDefinition</span> <span class="hljs-variable">def</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RootBeanDefinition</span>(EventListenerMethodProcessor.class);<br>      def.setSource(source);<br>      beanDefs.add(registerPostProcessor(registry, def, EVENT_LISTENER_PROCESSOR_BEAN_NAME));<br>   &#125;<br>		<span class="hljs-comment">// DefaultEventListenerFactory</span><br>   <span class="hljs-keyword">if</span> (!registry.containsBeanDefinition(EVENT_LISTENER_FACTORY_BEAN_NAME)) &#123;<br>      <span class="hljs-type">RootBeanDefinition</span> <span class="hljs-variable">def</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RootBeanDefinition</span>(DefaultEventListenerFactory.class);<br>      def.setSource(source);<br>      beanDefs.add(registerPostProcessor(registry, def, EVENT_LISTENER_FACTORY_BEAN_NAME));<br>   &#125;<br><br>   <span class="hljs-keyword">return</span> beanDefs;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="调用：PostProcessorRegistrationDelegate"><a href="#调用：PostProcessorRegistrationDelegate" class="headerlink" title="调用：PostProcessorRegistrationDelegate"></a>调用：PostProcessorRegistrationDelegate</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">invokeBeanFactoryPostProcessors</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PostProcessorRegistrationDelegate</span> &#123;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-title function_">PostProcessorRegistrationDelegate</span><span class="hljs-params">()</span> &#123;<br>	&#125;<br><br>	<span class="hljs-comment">// 执行时注册 ConfigurationClassPostProcessor ==》 BeanDefinitionRegistryPostProcessor</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invokeBeanFactoryPostProcessors</span><span class="hljs-params">(</span><br><span class="hljs-params">			ConfigurableListableBeanFactory beanFactory, List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessors)</span> &#123;<br><br>		<span class="hljs-comment">// WARNING: Although it may appear that the body of this method can be easily</span><br>		<span class="hljs-comment">// refactored to avoid the use of multiple loops and multiple lists, the use</span><br>		<span class="hljs-comment">// of multiple lists and multiple passes over the names of processors is</span><br>		<span class="hljs-comment">// intentional. We must ensure that we honor the contracts for PriorityOrdered</span><br>		<span class="hljs-comment">// and Ordered processors. Specifically, we must NOT cause processors to be</span><br>		<span class="hljs-comment">// instantiated (via getBean() invocations) or registered in the ApplicationContext</span><br>		<span class="hljs-comment">// in the wrong order.</span><br>		<span class="hljs-comment">//</span><br>		<span class="hljs-comment">// Before submitting a pull request (PR) to change this method, please review the</span><br>		<span class="hljs-comment">// list of all declined PRs involving changes to PostProcessorRegistrationDelegate</span><br>		<span class="hljs-comment">// to ensure that your proposal does not result in a breaking change:</span><br>		<span class="hljs-comment">// https://github.com/spring-projects/spring-framework/issues?q=PostProcessorRegistrationDelegate+is%3Aclosed+label%3A%22status%3A+declined%22</span><br><br>		<span class="hljs-comment">// 1、Invoke BeanDefinitionRegistryPostProcessors first, if any.</span><br>		Set&lt;String&gt; processedBeans = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>		<span class="hljs-comment">// 1、执行 传入的（当前BeanFactory中的 beanFactoryPostProcessors） 中的 BeanDefinitionRegistryPostProcessor</span><br>		<span class="hljs-keyword">if</span> (beanFactory <span class="hljs-keyword">instanceof</span> BeanDefinitionRegistry registry) &#123;<br>			List&lt;BeanFactoryPostProcessor&gt; regularPostProcessors = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>			List&lt;BeanDefinitionRegistryPostProcessor&gt; registryProcessors = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>			<span class="hljs-keyword">for</span> (BeanFactoryPostProcessor postProcessor : beanFactoryPostProcessors) &#123;<br>				<span class="hljs-keyword">if</span> (postProcessor <span class="hljs-keyword">instanceof</span> BeanDefinitionRegistryPostProcessor registryProcessor) &#123;<br>					registryProcessor.postProcessBeanDefinitionRegistry(registry);<br>					registryProcessors.add(registryProcessor);<br>				&#125;<br>				<span class="hljs-keyword">else</span> &#123;<br>					regularPostProcessors.add(postProcessor);<br>				&#125;<br>			&#125;<br><br>			<span class="hljs-comment">// Do not initialize FactoryBeans here: We need to leave all regular beans</span><br>			<span class="hljs-comment">// uninitialized to let the bean factory post-processors apply to them!</span><br>			<span class="hljs-comment">// Separate between BeanDefinitionRegistryPostProcessors that implement</span><br>			<span class="hljs-comment">// PriorityOrdered, Ordered, and the rest.</span><br>			List&lt;BeanDefinitionRegistryPostProcessor&gt; currentRegistryProcessors = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>			<span class="hljs-comment">// 2、PriorityOrdered 实现该接口的  BeanDefinitionRegistryPostProcessors 优先级最高 限制性</span><br>			<span class="hljs-comment">// First, invoke the BeanDefinitionRegistryPostProcessors that implement PriorityOrdered.</span><br>			String[] postProcessorNames =<br>					beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);<br>			<span class="hljs-keyword">for</span> (String ppName : postProcessorNames) &#123;<br>				<span class="hljs-keyword">if</span> (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123;<br>													<span class="hljs-comment">// 2、getBean() 显示创建 ConfigurationClassPostProcessor实例</span><br>					<span class="hljs-comment">// （问题：何处将 BeanDefinition 注册到容器中） ==》（回答： 在初始化容器context的时候会初始化 read\scan ，在refresh的 方法 postProcessBeanFactory</span><br>					<span class="hljs-comment">//   会调用 AbstractApplicationContext 的子类 ，web容器的 scan、register 方法，最终注册 BeanDefinition）</span><br>					<span class="hljs-comment">// 在这，通过BeanFactory的 getBean方法，实例化所有已经注册的BeanDefinition 为 BeanDefinitionRegistryPostProcessor 的类</span><br>					<span class="hljs-comment">// 即，初始化 会初始化ConfigurationClassPostProcessor  （问题：何处将 ConfigurationClassPostProcessor 注册为BeanDefinition？）</span><br>					<span class="hljs-comment">// （回答：context 的 annotation 或者 scan 的时候自动注册，或者和BeanFactoryPostProcessor 一样被注册）</span><br>					<span class="hljs-comment">// (具体回答：ConfigurationClassPostProcessor， 会在 AnnotationConfigServletWebServerApplicationContext ==》 AnnotatedBeanDefinitionReader 的</span><br>					<span class="hljs-comment">// 初始化过程中被 注册，因为这个 reader，会注册一些额外的 Processor增强器，实现一些功能)</span><br>					<span class="hljs-comment">/**</span><br><span class="hljs-comment">					 *  * &lt;p&gt;Registered by default when using &#123;<span class="hljs-doctag">@code</span> &lt;context:annotation-config/&gt;&#125; or</span><br><span class="hljs-comment">					 *  * &#123;<span class="hljs-doctag">@code</span> &lt;context:component-scan/&gt;&#125;. Otherwise, may be declared manually as</span><br><span class="hljs-comment">					 *  * with any other &#123;<span class="hljs-doctag">@link</span> BeanFactoryPostProcessor&#125;.</span><br><span class="hljs-comment">					 */</span><br>					currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));<br>					processedBeans.add(ppName);<br>				&#125;<br>			&#125;<br>			<span class="hljs-comment">// 对 registerProcessor进行排序</span><br>			sortPostProcessors(currentRegistryProcessors, beanFactory);<br>			registryProcessors.addAll(currentRegistryProcessors);<br>			<span class="hljs-comment">// 优先调用postProcessBeanDefinitionRegistry</span><br>			<span class="hljs-comment">// 调用 registerProcessor的 postProcessBeanDefinitionRegistry()</span><br>			invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());<br>			currentRegistryProcessors.clear();<br><br>			<span class="hljs-comment">//</span><br>			<span class="hljs-comment">// Ordered 实现该接口的  BeanDefinitionRegistryPostProcessors 较后执行</span><br>			<span class="hljs-comment">// Next, invoke the BeanDefinitionRegistryPostProcessors that implement Ordered.</span><br>			postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);<br>			<span class="hljs-keyword">for</span> (String ppName : postProcessorNames) &#123;<br>				<span class="hljs-keyword">if</span> (!processedBeans.contains(ppName) &amp;&amp; beanFactory.isTypeMatch(ppName, Ordered.class)) &#123;<br>												<span class="hljs-comment">// getBean() 根据AnnotatedBeanDefinitionReader注册的 BeanDefinition创建实列</span><br>					currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));<br>					processedBeans.add(ppName);<br>				&#125;<br>			&#125;<br>			sortPostProcessors(currentRegistryProcessors, beanFactory);<br>			registryProcessors.addAll(currentRegistryProcessors);<br>			<span class="hljs-comment">//</span><br>			invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());<br>			currentRegistryProcessors.clear();<br><br>			<span class="hljs-comment">// 最后执行 普通的BeanDefinitionRegistryPostProcessors</span><br>			<span class="hljs-comment">// Finally, invoke all other BeanDefinitionRegistryPostProcessors until no further ones appear.</span><br>			<span class="hljs-type">boolean</span> <span class="hljs-variable">reiterate</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>			<span class="hljs-keyword">while</span> (reiterate) &#123;<br>				reiterate = <span class="hljs-literal">false</span>;<br>				postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);<br>				<span class="hljs-keyword">for</span> (String ppName : postProcessorNames) &#123;<br>					<span class="hljs-keyword">if</span> (!processedBeans.contains(ppName)) &#123;<br>						currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));<br>						processedBeans.add(ppName);<br>						reiterate = <span class="hljs-literal">true</span>;<br>					&#125;<br>				&#125;<br>				sortPostProcessors(currentRegistryProcessors, beanFactory);<br>				registryProcessors.addAll(currentRegistryProcessors);<br>				invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());<br>				currentRegistryProcessors.clear();<br>			&#125;<br><br>			<span class="hljs-comment">// Now, invoke the postProcessBeanFactory callback of all processors handled so far.</span><br>			invokeBeanFactoryPostProcessors(registryProcessors, beanFactory);<br>			invokeBeanFactoryPostProcessors(regularPostProcessors, beanFactory);<br>		&#125;<br><br>		<span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-comment">// 执行容器的实例</span><br>			<span class="hljs-comment">// Invoke factory processors registered with the context instance.</span><br>			invokeBeanFactoryPostProcessors(beanFactoryPostProcessors, beanFactory);<br>		&#125;<br><br>		<span class="hljs-comment">// Do not initialize FactoryBeans here: We need to leave all regular beans</span><br>		<span class="hljs-comment">// uninitialized to let the bean factory post-processors apply to them!</span><br>		String[] postProcessorNames =<br>				beanFactory.getBeanNamesForType(BeanFactoryPostProcessor.class, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);<br><br>		<span class="hljs-comment">// Separate between BeanFactoryPostProcessors that implement PriorityOrdered,</span><br>		<span class="hljs-comment">// Ordered, and the rest.</span><br>		List&lt;BeanFactoryPostProcessor&gt; priorityOrderedPostProcessors = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>		List&lt;String&gt; orderedPostProcessorNames = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>		List&lt;String&gt; nonOrderedPostProcessorNames = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>		<span class="hljs-keyword">for</span> (String ppName : postProcessorNames) &#123;<br>			<span class="hljs-keyword">if</span> (processedBeans.contains(ppName)) &#123;<br>				<span class="hljs-comment">// skip - already processed in first phase above</span><br>			&#125;<br>			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123;<br>				priorityOrderedPostProcessors.add(beanFactory.getBean(ppName, BeanFactoryPostProcessor.class));<br>			&#125;<br>			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (beanFactory.isTypeMatch(ppName, Ordered.class)) &#123;<br>				orderedPostProcessorNames.add(ppName);<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				nonOrderedPostProcessorNames.add(ppName);<br>			&#125;<br>		&#125;<br>		<br>		<span class="hljs-comment">// 先执行 invokeBeanDefinitionRegistryPostProcessors() ## postProcessor.postProcessBeanDefinitionRegistry(registry);</span><br>		<span class="hljs-comment">// 再执行 invokeBeanFactoryPostProcessors() ## postProcessor.postProcessBeanFactory(beanFactory);</span><br>		<span class="hljs-comment">// First, invoke the BeanFactoryPostProcessors that implement PriorityOrdered.</span><br>		sortPostProcessors(priorityOrderedPostProcessors, beanFactory);<br>		invokeBeanFactoryPostProcessors(priorityOrderedPostProcessors, beanFactory);<br><br>		<span class="hljs-comment">// Next, invoke the BeanFactoryPostProcessors that implement Ordered.</span><br>		List&lt;BeanFactoryPostProcessor&gt; orderedPostProcessors = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(orderedPostProcessorNames.size());<br>		<span class="hljs-keyword">for</span> (String postProcessorName : orderedPostProcessorNames) &#123;<br>			orderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));<br>		&#125;<br>		sortPostProcessors(orderedPostProcessors, beanFactory);<br>		invokeBeanFactoryPostProcessors(orderedPostProcessors, beanFactory);<br><br>		<span class="hljs-comment">// Finally, invoke all other BeanFactoryPostProcessors.</span><br>		List&lt;BeanFactoryPostProcessor&gt; nonOrderedPostProcessors = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(nonOrderedPostProcessorNames.size());<br>		<span class="hljs-keyword">for</span> (String postProcessorName : nonOrderedPostProcessorNames) &#123;<br>			nonOrderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));<br>		&#125;<br>		invokeBeanFactoryPostProcessors(nonOrderedPostProcessors, beanFactory);<br><br>		<span class="hljs-comment">// Clear cached merged bean definitions since the post-processors might have</span><br>		<span class="hljs-comment">// modified the original metadata, e.g. replacing placeholders in values...</span><br>		beanFactory.clearMetadataCache();<br>	&#125;<br>  <br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="功能-Parser"><a href="#功能-Parser" class="headerlink" title="功能 - Parser"></a>功能 - Parser</h2><h2 id="ConfigurationClassParser"><a href="#ConfigurationClassParser" class="headerlink" title="ConfigurationClassParser"></a>ConfigurationClassParser</h2><h3 id="parse-入口"><a href="#parse-入口" class="headerlink" title="parse 入口"></a>parse 入口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 解析 已经有了 BeanDefinitionHolder对象，直接解析</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parse</span><span class="hljs-params">(Set&lt;BeanDefinitionHolder&gt; configCandidates)</span> &#123;<br>    <span class="hljs-comment">// 循环遍历</span><br>		<span class="hljs-keyword">for</span> (BeanDefinitionHolder holder : configCandidates) &#123;<br>			<span class="hljs-type">BeanDefinition</span> <span class="hljs-variable">bd</span> <span class="hljs-operator">=</span> holder.getBeanDefinition();<br>      <span class="hljs-comment">// 判断当前BeanDefinition 适合那种解析 </span><br>      <span class="hljs-comment">// 1、AnnotatedBeanDefinition、 == 元数据解析</span><br>      <span class="hljs-comment">// 2、AbstractBeanDefinition # hasBeanClass() == beanclass解析</span><br>      <span class="hljs-comment">// 3.其他 == beanname 解析</span><br>			<span class="hljs-keyword">try</span> &#123;<span class="hljs-comment">// 注解</span><br>				<span class="hljs-keyword">if</span> (bd <span class="hljs-keyword">instanceof</span> AnnotatedBeanDefinition annotatedBeanDef) &#123;<br>					parse(annotatedBeanDef.getMetadata(), holder.getBeanName());<br>				&#125; <span class="hljs-comment">//</span><br>				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (bd <span class="hljs-keyword">instanceof</span> AbstractBeanDefinition abstractBeanDef &amp;&amp; abstractBeanDef.hasBeanClass()) &#123;<br>					parse(abstractBeanDef.getBeanClass(), holder.getBeanName());<br>				&#125;<br>				<span class="hljs-keyword">else</span> &#123;<br>					parse(bd.getBeanClassName(), holder.getBeanName());<br>				&#125;<br>			&#125;<br>			<span class="hljs-keyword">catch</span> (BeanDefinitionStoreException ex) &#123;<br>				<span class="hljs-keyword">throw</span> ex;<br>			&#125;<br>			<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanDefinitionStoreException</span>(<br>						<span class="hljs-string">&quot;Failed to parse configuration class [&quot;</span> + bd.getBeanClassName() + <span class="hljs-string">&quot;]&quot;</span>, ex);<br>			&#125;<br>		&#125;<br>	<span class="hljs-comment">// </span><br>		<span class="hljs-built_in">this</span>.deferredImportSelectorHandler.process();<br>	&#125;<br><br>	<span class="hljs-comment">// 通过 类路径获取 MetadataReader,创建ConfigurationClass</span><br>	<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parse</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String className, String beanName)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>		Assert.notNull(className, <span class="hljs-string">&quot;No bean class name for configuration class bean definition&quot;</span>);<br>		<span class="hljs-type">MetadataReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.metadataReaderFactory.getMetadataReader(className);<br>		processConfigurationClass(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigurationClass</span>(reader, beanName), DEFAULT_EXCLUSION_FILTER);<br>	&#125;<br>	<span class="hljs-comment">// 通过Class对象直接创建 ConfigurationClass</span><br>	<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parse</span><span class="hljs-params">(Class&lt;?&gt; clazz, String beanName)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>		<span class="hljs-comment">// 创建 ConfigurationClass对象</span><br>		processConfigurationClass(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigurationClass</span>(clazz, beanName), DEFAULT_EXCLUSION_FILTER);<br>	&#125;<br><br>	<span class="hljs-comment">// 通过注解信息 创建ConfigurationClass</span><br>	<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parse</span><span class="hljs-params">(AnnotationMetadata metadata, String beanName)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>		processConfigurationClass(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigurationClass</span>(metadata, beanName), DEFAULT_EXCLUSION_FILTER);<br>	&#125;<br></code></pre></td></tr></table></figure>



<h3 id="processConfigurationClass"><a href="#processConfigurationClass" class="headerlink" title="processConfigurationClass"></a>processConfigurationClass</h3><p>解析 configuration Class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processConfigurationClass</span><span class="hljs-params">(ConfigurationClass configClass, Predicate&lt;String&gt; filter)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>		<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.conditionEvaluator.shouldSkip(configClass.getMetadata(), ConfigurationPhase.PARSE_CONFIGURATION)) &#123;<br>			<span class="hljs-keyword">return</span>;<br>		&#125;<br><br>		<span class="hljs-type">ConfigurationClass</span> <span class="hljs-variable">existingClass</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.configurationClasses.get(configClass);<br>		<span class="hljs-keyword">if</span> (existingClass != <span class="hljs-literal">null</span>) &#123;<br>			<span class="hljs-keyword">if</span> (configClass.isImported()) &#123;<br>				<span class="hljs-keyword">if</span> (existingClass.isImported()) &#123;<br>					existingClass.mergeImportedBy(configClass);<br>				&#125;<br>				<span class="hljs-comment">// Otherwise ignore new imported config class; existing non-imported class overrides it.</span><br>				<span class="hljs-keyword">return</span>;<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				<span class="hljs-comment">// Explicit bean definition found, probably replacing an import.</span><br>				<span class="hljs-comment">// Let&#x27;s remove the old one and go with the new one.</span><br>				<span class="hljs-built_in">this</span>.configurationClasses.remove(configClass);<br>				<span class="hljs-built_in">this</span>.knownSuperclasses.values().removeIf(configClass::equals);<br>			&#125;<br>		&#125;<br><br>		<span class="hljs-comment">// Recursively process the configuration class and its superclass hierarchy.</span><br>		<span class="hljs-type">SourceClass</span> <span class="hljs-variable">sourceClass</span> <span class="hljs-operator">=</span> asSourceClass(configClass, filter);<br>		<span class="hljs-keyword">do</span> &#123;<br>			<span class="hljs-comment">// 具体 ConfigurationClass 的 解析</span><br>			sourceClass = doProcessConfigurationClass(configClass, sourceClass, filter);<br>		&#125;<br>		<span class="hljs-keyword">while</span> (sourceClass != <span class="hljs-literal">null</span>);<br>		<span class="hljs-comment">// 添加 解析好的 configClass</span><br>		<span class="hljs-built_in">this</span>.configurationClasses.put(configClass, configClass);<br>	&#125;<br></code></pre></td></tr></table></figure>



<h3 id="doProcessConfigurationClass"><a href="#doProcessConfigurationClass" class="headerlink" title="doProcessConfigurationClass"></a>doProcessConfigurationClass</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><br><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> SourceClass <span class="hljs-title function_">doProcessConfigurationClass</span><span class="hljs-params">(</span><br><span class="hljs-params">		ConfigurationClass configClass, SourceClass sourceClass, Predicate&lt;String&gt; filter)</span><br>		<span class="hljs-keyword">throws</span> IOException &#123;<br><br>	<span class="hljs-keyword">if</span> (configClass.getMetadata().isAnnotated(Component.class.getName())) &#123;<br>		<span class="hljs-comment">// Recursively process any member (nested) classes first</span><br>		processMemberClasses(configClass, sourceClass, filter);<br>	&#125;<br><br>	<span class="hljs-comment">// Process any @PropertySource annotations</span><br>	<span class="hljs-keyword">for</span> (AnnotationAttributes propertySource : AnnotationConfigUtils.attributesForRepeatable(<br>			sourceClass.getMetadata(), PropertySources.class,<br>			org.springframework.context.annotation.PropertySource.class)) &#123;<br>		<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.propertySourceRegistry != <span class="hljs-literal">null</span>) &#123;<br>			<span class="hljs-built_in">this</span>.propertySourceRegistry.processPropertySource(propertySource);<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			logger.info(<span class="hljs-string">&quot;Ignoring @PropertySource annotation on [&quot;</span> + sourceClass.getMetadata().getClassName() +<br>					<span class="hljs-string">&quot;]. Reason: Environment must implement ConfigurableEnvironment&quot;</span>);<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">// Process any @ComponentScan annotations</span><br>	Set&lt;AnnotationAttributes&gt; componentScans = AnnotationConfigUtils.attributesForRepeatable(<br>			sourceClass.getMetadata(), ComponentScans.class, ComponentScan.class);<br>	<span class="hljs-keyword">if</span> (!componentScans.isEmpty() &amp;&amp;<br>			!<span class="hljs-built_in">this</span>.conditionEvaluator.shouldSkip(sourceClass.getMetadata(), ConfigurationPhase.REGISTER_BEAN)) &#123;<br>		<span class="hljs-keyword">for</span> (AnnotationAttributes componentScan : componentScans) &#123;<br>			<span class="hljs-comment">// The config class is annotated with @ComponentScan -&gt; perform the scan immediately</span><br>			Set&lt;BeanDefinitionHolder&gt; scannedBeanDefinitions =<br>					<span class="hljs-built_in">this</span>.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName());<br>			<span class="hljs-comment">// Check the set of scanned definitions for any further config classes and parse recursively if needed</span><br>			<span class="hljs-keyword">for</span> (BeanDefinitionHolder holder : scannedBeanDefinitions) &#123;<br>				<span class="hljs-type">BeanDefinition</span> <span class="hljs-variable">bdCand</span> <span class="hljs-operator">=</span> holder.getBeanDefinition().getOriginatingBeanDefinition();<br>				<span class="hljs-keyword">if</span> (bdCand == <span class="hljs-literal">null</span>) &#123;<br>					bdCand = holder.getBeanDefinition();<br>				&#125;<br>				<span class="hljs-keyword">if</span> (ConfigurationClassUtils.checkConfigurationClassCandidate(bdCand, <span class="hljs-built_in">this</span>.metadataReaderFactory)) &#123;<br>					parse(bdCand.getBeanClassName(), holder.getBeanName());<br>				&#125;<br>			&#125;<br>		&#125;<br>	&#125;<br>	<span class="hljs-comment">// 关键 -- 自动注入 -- 实现接口，方法调用</span><br>	<span class="hljs-comment">// Process any @Import annotations</span><br>	processImports(configClass, sourceClass, getImports(sourceClass), filter, <span class="hljs-literal">true</span>);<br><br>	<span class="hljs-comment">// Process any @ImportResource annotations</span><br>	<span class="hljs-type">AnnotationAttributes</span> <span class="hljs-variable">importResource</span> <span class="hljs-operator">=</span><br>			AnnotationConfigUtils.attributesFor(sourceClass.getMetadata(), ImportResource.class);<br>	<span class="hljs-keyword">if</span> (importResource != <span class="hljs-literal">null</span>) &#123;<br>		String[] resources = importResource.getStringArray(<span class="hljs-string">&quot;locations&quot;</span>);<br>		Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BeanDefinitionReader</span>&gt; readerClass = importResource.getClass(<span class="hljs-string">&quot;reader&quot;</span>);<br>		<span class="hljs-keyword">for</span> (String resource : resources) &#123;<br>			<span class="hljs-type">String</span> <span class="hljs-variable">resolvedResource</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.environment.resolveRequiredPlaceholders(resource);<br>			configClass.addImportedResource(resolvedResource, readerClass);<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">// Process individual @Bean methods</span><br>	Set&lt;MethodMetadata&gt; beanMethods = retrieveBeanMethodMetadata(sourceClass);<br>	<span class="hljs-keyword">for</span> (MethodMetadata methodMetadata : beanMethods) &#123;<br>		configClass.addBeanMethod(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanMethod</span>(methodMetadata, configClass));<br>	&#125;<br><br>	<span class="hljs-comment">// Process default methods on interfaces</span><br>	processInterfaces(configClass, sourceClass);<br><br>	<span class="hljs-comment">// Process superclass, if any</span><br>	<span class="hljs-keyword">if</span> (sourceClass.getMetadata().hasSuperClass()) &#123;<br>		<span class="hljs-type">String</span> <span class="hljs-variable">superclass</span> <span class="hljs-operator">=</span> sourceClass.getMetadata().getSuperClassName();<br>		<span class="hljs-keyword">if</span> (superclass != <span class="hljs-literal">null</span> &amp;&amp; !superclass.startsWith(<span class="hljs-string">&quot;java&quot;</span>) &amp;&amp;<br>				!<span class="hljs-built_in">this</span>.knownSuperclasses.containsKey(superclass)) &#123;<br>			<span class="hljs-built_in">this</span>.knownSuperclasses.put(superclass, configClass);<br>			<span class="hljs-comment">// Superclass found, return its annotation metadata and recurse</span><br>			<span class="hljs-keyword">return</span> sourceClass.getSuperClass();<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">// No superclass -&gt; processing is complete</span><br>	<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="ConfigurationClassBeanDefinitionReader"><a href="#ConfigurationClassBeanDefinitionReader" class="headerlink" title="ConfigurationClassBeanDefinitionReader"></a>ConfigurationClassBeanDefinitionReader</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ## ConfigurationClassPostProcessor ##</span><br>	<span class="hljs-comment">// ConfigurationClassParser ##</span><br>			parser.parse(candidates);<br>			parser.validate();<br><br>			<span class="hljs-comment">// 获取 parse 解析好的 configClass 集合</span><br>			Set&lt;ConfigurationClass&gt; configClasses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;(parser.getConfigurationClasses());<br>			configClasses.removeAll(alreadyParsed);<br><br>			<span class="hljs-comment">// Read the model and create bean definitions based on its content</span><br>			<span class="hljs-comment">// 读取模式，并基于ConfigurationClass信息创建beanDefinition</span><br>			<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.reader == <span class="hljs-literal">null</span>) &#123;<br>				<span class="hljs-comment">// 初始化 ConfigurationClassBeanDefinitionReader</span><br>				<span class="hljs-built_in">this</span>.reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigurationClassBeanDefinitionReader</span>(<br>						registry, <span class="hljs-built_in">this</span>.sourceExtractor, <span class="hljs-built_in">this</span>.resourceLoader, <span class="hljs-built_in">this</span>.environment,<br>						<span class="hljs-built_in">this</span>.importBeanNameGenerator, parser.getImportRegistry());<br>			&#125;<br>			<span class="hljs-comment">// 通过ConfigurationClassParser 解析的ConfiguratioClass信息</span><br>			<span class="hljs-comment">// 加载 信息中的 BeanDefinition （@Bean, @ImportBeanDefinitionRegistrar, </span><br>					<span class="hljs-comment">// @ImportResource, @Configuration）</span><br>			<span class="hljs-built_in">this</span>.reader.loadBeanDefinitions(configClasses);<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 读取一组已经被完整解析的配置类ConfigurationClass，向给定bean容器BeanDefinitionRegistry注册其中所有的bean定义。</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadBeanDefinitions</span><span class="hljs-params">(Set&lt;ConfigurationClass&gt; configurationModel)</span> &#123;<br>		<span class="hljs-type">TrackedConditionEvaluator</span> <span class="hljs-variable">trackedConditionEvaluator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TrackedConditionEvaluator</span>();<br>		<span class="hljs-comment">// 遍历当前 ConfigurationClass 集合</span><br>		<span class="hljs-keyword">for</span> (ConfigurationClass configClass : configurationModel) &#123;<br>			<span class="hljs-comment">// 通过 ConfigrationClass 加载对应的 BeanDefinition （@Bean, @ImportBeanDefinitionRegistrar, @ImportResource, @Configuration）</span><br>			loadBeanDefinitionsForConfigurationClass(configClass, trackedConditionEvaluator);<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Read a particular &#123;<span class="hljs-doctag">@link</span> ConfigurationClass&#125;, registering bean definitions</span><br><span class="hljs-comment">	 * for the class itself and all of its &#123;<span class="hljs-doctag">@link</span> Bean&#125; methods.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadBeanDefinitionsForConfigurationClass</span><span class="hljs-params">(</span><br><span class="hljs-params">			ConfigurationClass configClass, TrackedConditionEvaluator trackedConditionEvaluator)</span> &#123;<br><br>		<span class="hljs-comment">// 如果 条件Condition判断 应当跳过当前配置类，则从当前registry中移除 BeanDefinition信息</span><br>		<span class="hljs-keyword">if</span> (trackedConditionEvaluator.shouldSkip(configClass)) &#123;<br>			<span class="hljs-type">String</span> <span class="hljs-variable">beanName</span> <span class="hljs-operator">=</span> configClass.getBeanName();<br>			<span class="hljs-keyword">if</span> (StringUtils.hasLength(beanName) &amp;&amp; <span class="hljs-built_in">this</span>.registry.containsBeanDefinition(beanName)) &#123;<br>				<span class="hljs-built_in">this</span>.registry.removeBeanDefinition(beanName);<br>			&#125;<br>			<span class="hljs-built_in">this</span>.importRegistry.removeImportingClass(configClass.getMetadata().getClassName());<br>			<span class="hljs-keyword">return</span>;<br>		&#125;<br><br>		<span class="hljs-keyword">if</span> (configClass.isImported()) &#123;<br>			<span class="hljs-comment">// 将 ConfigurationClass 自己加载为 BeanDefinition （@Configuration）</span><br>			registerBeanDefinitionForImportedConfigurationClass(configClass);<br>		&#125;<br>		<span class="hljs-comment">// 遍历configClass的 BeanMethod （@Bean注解信息），加载为BeanDefinition</span><br>		<span class="hljs-comment">// 将 @Bean 解析为 BeanDefinition</span><br>		<span class="hljs-keyword">for</span> (BeanMethod beanMethod : configClass.getBeanMethods()) &#123;<br>			loadBeanDefinitionsForBeanMethod(beanMethod);<br>		&#125;<br>		<span class="hljs-comment">// 参数：Map&lt;String, Class&lt;? extends BeanDefinitionReader&gt;&gt;</span><br>		<span class="hljs-comment">// 将@ImportResource的信息 注册为BeanDefinition</span><br>		loadBeanDefinitionsFromImportedResources(configClass.getImportedResources());<br>		<span class="hljs-comment">// 参数：Map&lt;ImportBeanDefinitionRegistrar, AnnotationMetadata&gt;</span><br>		<span class="hljs-comment">// @ImportBeanDefinitionRegistrar 的 注解信息，床架BeanDefinition</span><br>		loadBeanDefinitionsFromRegistrars(configClass.getImportBeanDefinitionRegistrars());<br>	&#125;<br></code></pre></td></tr></table></figure>







<h1 id="2-3-BeanPostProcessor"><a href="#2-3-BeanPostProcessor" class="headerlink" title="2.3 BeanPostProcessor"></a>2.3 BeanPostProcessor</h1><p>用于对Bean  初始化（initialization）过程的 前后进行增强</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanPostProcessor</span> &#123;<br><br>   <span class="hljs-meta">@Nullable</span><br>   <span class="hljs-keyword">default</span> Object <span class="hljs-title function_">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>      <span class="hljs-keyword">return</span> bean;<br>   &#125;<br><br>   <span class="hljs-meta">@Nullable</span><br>   <span class="hljs-keyword">default</span> Object <span class="hljs-title function_">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>      <span class="hljs-keyword">return</span> bean;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="2-3-1-接口interface"><a href="#2-3-1-接口interface" class="headerlink" title="2.3.1 接口interface"></a>2.3.1 接口interface</h2><h3 id="InstantiationAwareBeanPostProcessor"><a href="#InstantiationAwareBeanPostProcessor" class="headerlink" title="InstantiationAwareBeanPostProcessor"></a>InstantiationAwareBeanPostProcessor</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">InstantiationAwareBeanPostProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BeanPostProcessor</span> &#123;<br>	<span class="hljs-comment">// 实例化前 （newInstance）</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">default</span> Object <span class="hljs-title function_">postProcessBeforeInstantiation</span><span class="hljs-params">(Class&lt;?&gt; beanClass, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>	&#125;<br>	<span class="hljs-comment">// 实例化后</span><br>	<span class="hljs-keyword">default</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">postProcessAfterInstantiation</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>	&#125;<br>	<span class="hljs-comment">// 属性增强（autowired）</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">default</span> PropertyValues <span class="hljs-title function_">postProcessProperties</span><span class="hljs-params">(PropertyValues pvs, Object bean, String beanName)</span><br>			<span class="hljs-keyword">throws</span> BeansException &#123;<br><br>		<span class="hljs-keyword">return</span> pvs;<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="InitializingBean"><a href="#InitializingBean" class="headerlink" title="InitializingBean"></a>InitializingBean</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">InitializingBean</span> &#123;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Invoked by the containing &#123;<span class="hljs-doctag">@code</span> BeanFactory&#125; after it has set all bean properties</span><br><span class="hljs-comment">    * and satisfied &#123;<span class="hljs-doctag">@link</span> BeanFactoryAware&#125;, &#123;<span class="hljs-doctag">@code</span> ApplicationContextAware&#125; etc.</span><br><span class="hljs-comment">    * &lt;p&gt;This method allows the bean instance to perform validation of its overall</span><br><span class="hljs-comment">    * configuration and final initialization when all bean properties have been set.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> Exception in the event of misconfiguration (such as failure to set an</span><br><span class="hljs-comment">    * essential property) or if initialization fails for any other reason</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="SmartInstantiationAwareBeanPostProcessor"><a href="#SmartInstantiationAwareBeanPostProcessor" class="headerlink" title="SmartInstantiationAwareBeanPostProcessor"></a>SmartInstantiationAwareBeanPostProcessor</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SmartInstantiationAwareBeanPostProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InstantiationAwareBeanPostProcessor</span> &#123;<br>	<span class="hljs-comment">// 推测bean 类型</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">default</span> Class&lt;?&gt; predictBeanType(Class&lt;?&gt; beanClass, String beanName) <span class="hljs-keyword">throws</span> BeansException &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>	&#125;<br>	<span class="hljs-comment">// 确定bean type</span><br>	<span class="hljs-keyword">default</span> Class&lt;?&gt; determineBeanType(Class&lt;?&gt; beanClass, String beanName) <span class="hljs-keyword">throws</span> BeansException &#123;<br>		<span class="hljs-keyword">return</span> beanClass;<br>	&#125;<br>	<span class="hljs-comment">// 确定候选 构造器列表（可用构造器）</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">default</span> Constructor&lt;?&gt;[] determineCandidateConstructors(Class&lt;?&gt; beanClass, String beanName)<br>			<span class="hljs-keyword">throws</span> BeansException &#123;<br><br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Obtain a reference for early access to the specified bean,</span><br><span class="hljs-comment">	 * typically for the purpose of resolving a circular reference.</span><br><span class="hljs-comment">	 * &lt;p&gt;This callback gives post-processors a chance to expose a wrapper</span><br><span class="hljs-comment">	 * early - that is, before the target bean instance is fully initialized.</span><br><span class="hljs-comment">	 * The exposed object should be equivalent to the what</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@link</span> #postProcessBeforeInitialization&#125; / &#123;<span class="hljs-doctag">@link</span> #postProcessAfterInitialization&#125;</span><br><span class="hljs-comment">	 * would expose otherwise. Note that the object returned by this method will</span><br><span class="hljs-comment">	 * be used as bean reference unless the post-processor returns a different</span><br><span class="hljs-comment">	 * wrapper from said post-process callbacks. In other words: Those post-process</span><br><span class="hljs-comment">	 * callbacks may either eventually expose the same reference or alternatively</span><br><span class="hljs-comment">	 * return the raw bean instance from those subsequent callbacks (if the wrapper</span><br><span class="hljs-comment">	 * for the affected bean has been built for a call to this method already,</span><br><span class="hljs-comment">	 * it will be exposes as final bean reference by default).</span><br><span class="hljs-comment">	 * &lt;p&gt;The default implementation returns the given &#123;<span class="hljs-doctag">@code</span> bean&#125; as-is.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> bean the raw bean instance</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> beanName the name of the bean</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the object to expose as bean reference</span><br><span class="hljs-comment">	 * (typically with the passed-in bean instance as default)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> org.springframework.beans.BeansException in case of errors</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">default</span> Object <span class="hljs-title function_">getEarlyBeanReference</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>		<span class="hljs-keyword">return</span> bean;<br>	&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>



<h3 id="MergedBeanDefinitionPostProcessor"><a href="#MergedBeanDefinitionPostProcessor" class="headerlink" title="MergedBeanDefinitionPostProcessor"></a>MergedBeanDefinitionPostProcessor</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MergedBeanDefinitionPostProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BeanPostProcessor</span> &#123;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Post-process the given merged bean definition for the specified bean.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> beanDefinition the merged bean definition for the bean</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> beanType the actual type of the managed bean instance</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> beanName the name of the bean</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@see</span> AbstractAutowireCapableBeanFactory#applyMergedBeanDefinitionPostProcessors</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessMergedBeanDefinition</span><span class="hljs-params">(RootBeanDefinition beanDefinition, Class&lt;?&gt; beanType, String beanName)</span>;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * A notification that the bean definition for the specified name has been reset,</span><br><span class="hljs-comment">    * and that this post-processor should clear any metadata for the affected bean.</span><br><span class="hljs-comment">    * &lt;p&gt;The default implementation is empty.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> beanName the name of the bean</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@since</span> 5.1</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@see</span> DefaultListableBeanFactory#resetBeanDefinition</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">resetBeanDefinition</span><span class="hljs-params">(String beanName)</span> &#123;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p>具体作用类（实现类）</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">eanPostProcessor接口是Spring框架中的一个扩展点，用于在<span class="hljs-keyword">Bean实例化和初始化的过程中对Bean进行增强或修改。通过实现BeanPostProcessor接口，可以在Bean的生命周期中插入自定义的逻辑，以达到增强效果。</span><br><span class="hljs-keyword"></span><br>以下是一些常见的实现<span class="hljs-keyword">BeanPostProcessor接口的类，以及它们的主要用途：</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">1</span>. CommonAnnotationBeanPostProcessor：这是Spring框架内置的一个实现类，用于处理常见的注解，如@PostConstruct和@PreDestroy。它会在<span class="hljs-keyword">Bean的初始化阶段调用相应的方法。</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">2</span>. AutowiredAnnotationBeanPostProcessor：这是Spring框架内置的一个实现类，用于处理@Autowired和@Resource等注解的解析和处理。它会在<span class="hljs-keyword">Bean的实例化和初始化阶段对带有这些注解的字段或方法进行依赖注入。</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">3</span>. <span class="hljs-keyword">BeanValidationPostProcessor：这是Spring框架内置的一个实现类，用于支持Bean的校验。它会在Bean的初始化阶段对带有校验注解（如@Valid）的字段进行校验。</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">4</span>. CustomBeanPostProcessor：这是自定义的实现类，可以根据具体需求实现自定义的<span class="hljs-keyword">Bean后置处理逻辑。例如，可以在Bean的初始化阶段对特定的属性进行修改或添加额外的逻辑。</span><br><span class="hljs-keyword"></span><br>这些实现类的主要用途是在<span class="hljs-keyword">Bean的生命周期中对Bean进行增强或修改。例如，CommonAnnotationBeanPostProcessor用于处理常见的注解，AutowiredAnnotationBeanPostProcessor用于处理依赖注入，BeanValidationPostProcessor用于支持校验等。</span><br><span class="hljs-keyword"></span><br>需要注意的是，<span class="hljs-keyword">BeanPostProcessor接口的实现类在Spring容器启动时会被自动检测并应用于相应的Bean。它们可以通过实现Ordered接口或使用@Order注解来指定执行的顺序。</span><br><span class="hljs-keyword"></span><br>这些是一些常见的<span class="hljs-keyword">BeanPostProcessor实现类及其主要用途的介绍。如果您想了解更多关于BeanPostProcessor的实现类的信息，建议查阅Spring框架的官方文档或相关的教程资料。</span><br><span class="hljs-keyword"></span><br>如果您有其他问题，请随时提问。<br></code></pre></td></tr></table></figure>

<p>实现接口</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">除了<span class="hljs-keyword">BeanPostProcessor接口外，Spring框架还提供了其他一些增强子接口，用于在Bean的生命周期中进行特定的操作。以下是一些常见的增强子接口及其主要用途：</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">1</span>. <span class="hljs-keyword">InstantiationAwareBeanPostProcessor：该接口继承自BeanPostProcessor接口，提供了在Bean实例化之前和之后进行自定义处理的能力。它可以在Bean实例化之前修改Bean的实例化方式，或者在Bean实例化之后对Bean进行进一步的处理。</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">2</span>. DestructionAwareBeanPostProcessor：该接口继承自<span class="hljs-keyword">BeanPostProcessor接口，提供了在Bean销毁之前进行自定义处理的能力。它可以在Bean销毁之前执行一些清理操作，例如释放资源或发送通知。</span><br><span class="hljs-keyword"></span><br><br><br><span class="hljs-number">4</span>. SmartInstantiationAwareBeanPostProcessor：该接口继承自<span class="hljs-keyword">InstantiationAwareBeanPostProcessor接口，提供了更精细的控制能力。它可以在Bean实例化之前选择自定义的实例化策略，并在实例化之后对Bean进行进一步的处理。</span><br><span class="hljs-keyword"></span><br>这些增强子接口可以根据具体需求进行实现，以实现对<span class="hljs-keyword">Bean的定制化操作。通过实现这些接口，可以在Bean的生命周期中插入自定义的逻辑，例如修改Bean的实例化方式、对Bean进行进一步的处理或执行清理操作。</span><br><span class="hljs-keyword"></span><br>需要注意的是，增强子接口的实现类在Spring容器启动时会被自动检测并应用于相应的<span class="hljs-keyword">Bean。它们可以通过实现Ordered接口或使用@Order注解来指定执行的顺序。</span><br><span class="hljs-keyword"></span><br>希望这个回答对您有帮助。如果您有其他问题，请随时提问。<br></code></pre></td></tr></table></figure>







<h2 id="2-3-2-实现类"><a href="#2-3-2-实现类" class="headerlink" title="2.3.2 实现类"></a>2.3.2 实现类</h2><h3 id="AutowiredAnnotationBeanPostProcessor"><a href="#AutowiredAnnotationBeanPostProcessor" class="headerlink" title="AutowiredAnnotationBeanPostProcessor"></a>AutowiredAnnotationBeanPostProcessor</h3><p>自动注入 </p>
<p>2.1.2.1 DefaultListableBeanFactory</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure>







<h1 id="《注册-Registry》"><a href="#《注册-Registry》" class="headerlink" title="《注册 Registry》"></a>《注册 Registry》</h1><h1 id="2-4-BeanDefinitionRegistry"><a href="#2-4-BeanDefinitionRegistry" class="headerlink" title="2.4 BeanDefinitionRegistry"></a>2.4 BeanDefinitionRegistry</h1><p>管理BeanDefinition , 管理容器的 BeanDefinition </p>
<p>实现类都是 Context ，用于上下文管理BeanDefinition</p>
<p><img src="/Users/where/Library/Application%20Support/typora-user-images/image-20230808210957497.png" srcset="/img/loading.gif" lazyload alt="image-20230808210957497"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanDefinitionRegistry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AliasRegistry</span> &#123;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Register a new bean definition with this registry.</span><br><span class="hljs-comment">    * Must support RootBeanDefinition and ChildBeanDefinition.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> beanName the name of the bean instance to register</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> beanDefinition definition of the bean instance to register</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> BeanDefinitionStoreException if the BeanDefinition is invalid</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> BeanDefinitionOverrideException if there is already a BeanDefinition</span><br><span class="hljs-comment">    * for the specified bean name and we are not allowed to override it</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@see</span> GenericBeanDefinition</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@see</span> RootBeanDefinition</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@see</span> ChildBeanDefinition</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerBeanDefinition</span><span class="hljs-params">(String beanName, BeanDefinition beanDefinition)</span><br>         <span class="hljs-keyword">throws</span> BeanDefinitionStoreException;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Remove the BeanDefinition for the given name.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> beanName the name of the bean instance to register</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> NoSuchBeanDefinitionException if there is no such bean definition</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeBeanDefinition</span><span class="hljs-params">(String beanName)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Return the BeanDefinition for the given bean name.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> beanName name of the bean to find a definition for</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> the BeanDefinition for the given name (never &#123;<span class="hljs-doctag">@code</span> null&#125;)</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@throws</span> NoSuchBeanDefinitionException if there is no such bean definition</span><br><span class="hljs-comment">    */</span><br>   BeanDefinition <span class="hljs-title function_">getBeanDefinition</span><span class="hljs-params">(String beanName)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Check if this registry contains a bean definition with the given name.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> beanName the name of the bean to look for</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> if this registry contains a bean definition with the given name</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsBeanDefinition</span><span class="hljs-params">(String beanName)</span>;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Return the names of all beans defined in this registry.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> the names of all beans defined in this registry,</span><br><span class="hljs-comment">    * or an empty array if none defined</span><br><span class="hljs-comment">    */</span><br>   String[] getBeanDefinitionNames();<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Return the number of beans defined in the registry.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> the number of beans defined in the registry</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-type">int</span> <span class="hljs-title function_">getBeanDefinitionCount</span><span class="hljs-params">()</span>;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Determine whether the given bean name is already in use within this registry,</span><br><span class="hljs-comment">    * i.e. whether there is a local bean or alias registered under this name.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> beanName the name to check</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> whether the given bean name is already in use</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-type">boolean</span> <span class="hljs-title function_">isBeanNameInUse</span><span class="hljs-params">(String beanName)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h1 id="2-5-AnnotationConfigRegistry"><a href="#2-5-AnnotationConfigRegistry" class="headerlink" title="2.5 AnnotationConfigRegistry"></a>2.5 AnnotationConfigRegistry</h1><p>web、servlet、react （web容器）的实现，注解扫描 注册 Bean</p>
<p><img src="https://raw.githubusercontent.com/wherezy1/PicGOImageShack/main/images/image-20230808212447647.png" srcset="/img/loading.gif" lazyload alt="image-20230808212447647"></p>
<p>注解配置的 注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AnnotationConfigRegistry</span> &#123;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Register one or more component classes to be processed.</span><br><span class="hljs-comment">    * &lt;p&gt;Calls to &#123;<span class="hljs-doctag">@code</span> register&#125; are idempotent; adding the same</span><br><span class="hljs-comment">    * component class more than once has no additional effect.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> componentClasses one or more component classes,</span><br><span class="hljs-comment">    * e.g. &#123;<span class="hljs-doctag">@link</span> Configuration <span class="hljs-doctag">@Configuration</span>&#125; classes</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(Class&lt;?&gt;... componentClasses)</span>;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Perform a scan within the specified base packages.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> basePackages the packages to scan for component classes</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">scan</span><span class="hljs-params">(String... basePackages)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h1 id="第三部分-Spring-Core"><a href="#第三部分-Spring-Core" class="headerlink" title="第三部分 Spring Core"></a>第三部分 Spring Core</h1><h1 id="3-1-Utils"><a href="#3-1-Utils" class="headerlink" title="3.1 Utils"></a>3.1 Utils</h1><h2 id="SpringFactoriesLoader"><a href="#SpringFactoriesLoader" class="headerlink" title="SpringFactoriesLoader"></a>SpringFactoriesLoader</h2><p>加载 spring.factories 文件的类 k-v 类，loadFactories</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringFactoriesLoader</span> &#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * The location to look for factories.</span><br><span class="hljs-comment">	 * &lt;p&gt;Can be present in multiple JAR files.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FACTORIES_RESOURCE_LOCATION</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;META-INF/spring.factories&quot;</span>;<br><br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Log</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LogFactory.getLog(SpringFactoriesLoader.class);<br><br>	<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;ClassLoader, Map&lt;String, List&lt;String&gt;&gt;&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentReferenceHashMap</span>&lt;&gt;();<br><br><br>	<span class="hljs-keyword">private</span> <span class="hljs-title function_">SpringFactoriesLoader</span><span class="hljs-params">()</span> &#123;<br>	&#125;<br><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; List&lt;T&gt; <span class="hljs-title function_">loadFactories</span><span class="hljs-params">(Class&lt;T&gt; factoryType, <span class="hljs-meta">@Nullable</span> ClassLoader classLoader)</span> &#123;<br>		Assert.notNull(factoryType, <span class="hljs-string">&quot;&#x27;factoryType&#x27; must not be null&quot;</span>);<br>		<span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoaderToUse</span> <span class="hljs-operator">=</span> classLoader;<br>		<span class="hljs-keyword">if</span> (classLoaderToUse == <span class="hljs-literal">null</span>) &#123;<br>			classLoaderToUse = SpringFactoriesLoader.class.getClassLoader();<br>		&#125;<br>		List&lt;String&gt; factoryImplementationNames = loadFactoryNames(factoryType, classLoaderToUse);<br>		<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>			logger.trace(<span class="hljs-string">&quot;Loaded [&quot;</span> + factoryType.getName() + <span class="hljs-string">&quot;] names: &quot;</span> + factoryImplementationNames);<br>		&#125;<br>		List&lt;T&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(factoryImplementationNames.size());<br>		<span class="hljs-keyword">for</span> (String factoryImplementationName : factoryImplementationNames) &#123;<br>			result.add(instantiateFactory(factoryImplementationName, factoryType, classLoaderToUse));<br>		&#125;<br>		AnnotationAwareOrderComparator.sort(result);<br>		<span class="hljs-keyword">return</span> result;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h1 id="3-2-IO"><a href="#3-2-IO" class="headerlink" title="3.2 IO"></a>3.2 IO</h1><h2 id="InputStreamSource"><a href="#InputStreamSource" class="headerlink" title="InputStreamSource"></a>InputStreamSource</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">InputStreamSource</span> &#123;<br><br>	InputStream <span class="hljs-title function_">getInputStream</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a>Resource</h2><p>URI URL File</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/** * <span class="hljs-doctag">@see</span> #getInputStream()</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> #getURL()</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> #getURI()</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> #getFile()</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> WritableResource</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> ContextResource</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> UrlResource</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> FileUrlResource</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> FileSystemResource</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> ClassPathResource</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> ByteArrayResource</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> InputStreamResource</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Resource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputStreamSource</span> &#123;<br>  URL <span class="hljs-title function_">getURL</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException;<br><br>	URI <span class="hljs-title function_">getURI</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException;<br><br>	File <span class="hljs-title function_">getFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException;<br> 	<span class="hljs-keyword">default</span> ReadableByteChannel <span class="hljs-title function_">readableChannel</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>		<span class="hljs-keyword">return</span> Channels.newChannel(getInputStream());<br>	&#125;<br><br>	<span class="hljs-keyword">default</span> <span class="hljs-type">byte</span>[] getContentAsByteArray() <span class="hljs-keyword">throws</span> IOException &#123;<br>		<span class="hljs-keyword">return</span> FileCopyUtils.copyToByteArray(getInputStream());<br>	&#125;<br><br>  <span class="hljs-keyword">default</span> String <span class="hljs-title function_">getContentAsString</span><span class="hljs-params">(Charset charset)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>		<span class="hljs-keyword">return</span> FileCopyUtils.copyToString(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(getInputStream(), charset));<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="ResourceLoader"><a href="#ResourceLoader" class="headerlink" title="ResourceLoader"></a>ResourceLoader</h2><p>用于加载资源，获取Resource </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ResourceLoader</span> &#123;<br><br>   <span class="hljs-comment">/** Pseudo URL prefix for loading from the class path: &quot;classpath:&quot;. */</span><br>   <span class="hljs-type">String</span> <span class="hljs-variable">CLASSPATH_URL_PREFIX</span> <span class="hljs-operator">=</span> ResourceUtils.CLASSPATH_URL_PREFIX;<br>	<span class="hljs-comment">// Resource</span><br>   Resource <span class="hljs-title function_">getResource</span><span class="hljs-params">(String location)</span>;<br>	<span class="hljs-comment">// ClassLoader</span><br>   <span class="hljs-meta">@Nullable</span><br>   ClassLoader <span class="hljs-title function_">getClassLoader</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>









<h1 id="第四部分-Spring-AOP"><a href="#第四部分-Spring-AOP" class="headerlink" title="第四部分 Spring AOP"></a>第四部分 Spring AOP</h1><h1 id="4-1-创建代理对象"><a href="#4-1-创建代理对象" class="headerlink" title="4.1 创建代理对象"></a>4.1 创建代理对象</h1><h2 id="AbstractAutoProxyCreator"><a href="#AbstractAutoProxyCreator" class="headerlink" title="AbstractAutoProxyCreator"></a>AbstractAutoProxyCreator</h2><p>-》BeanPostProcessor</p>
<p>在Bean 初始化的时候，为其生成代理对象，是 AOP的切入重点</p>
<p><img src="https://raw.githubusercontent.com/wherezy1/PicGOImageShack/main/images/image-20230730231209293.png" srcset="/img/loading.gif" lazyload alt="image-20230730231209293"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractAutoProxyCreator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ProxyProcessorSupport</span><br>		<span class="hljs-keyword">implements</span> <span class="hljs-title class_">SmartInstantiationAwareBeanPostProcessor</span>, BeanFactoryAware &#123;<br> &#125;<br></code></pre></td></tr></table></figure>













<h1 id="最后一部分-特殊名词"><a href="#最后一部分-特殊名词" class="headerlink" title="最后一部分 特殊名词"></a>最后一部分 特殊名词</h1><h2 id="AOT-x3D-x3D-Ahead-Of-Time"><a href="#AOT-x3D-x3D-Ahead-Of-Time" class="headerlink" title="AOT &#x3D;&#x3D;  Ahead-Of-Time"></a>AOT &#x3D;&#x3D;  Ahead-Of-Time</h2><p>Spring中的AOT是Ahead-Of-Time的缩写，是指将应用程序在编译时预先转译成本地机器代码的技术。AOT可以提高应用程序的性能和启动速度，因为它省去了运行时动态编译的过程。在Spring中，AOT支持是通过Spring Native项目实现的，它可以将Spring应用程序编译成原生镜像，以提供更快的启动时间和更小的内存占用。Spring Native通过GraalVM将Spring应用程序进行AOT编译，使用新的AOT引擎深度分析应用程序，并生成所需的GraalVM本机配置。这些转换由Maven和Gradle的Spring AOT插件执行。</p>
<p>参考搜索结果:</p>
<p>[<a target="_blank" rel="noopener" href="https://www.jdon.com/57953.html">1]更快更省：带有新AOT引擎的Spring Native 0.11 发布- spring.io - 解道Jdon</a></p>
<p>[<a target="_blank" rel="noopener" href="https://www.cnblogs.com/510602159-Yano/p/14591079.html">4]Spring Native 项目，把Spring 项目编译成原生程序！ - 博客园</a></p>
<h2 id="JNDI-Java-Naming-and-Directory-Interface"><a href="#JNDI-Java-Naming-and-Directory-Interface" class="headerlink" title="JNDI(Java Naming and Directory Interface)"></a>JNDI(Java Naming and Directory Interface)</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">JNDI是Java </span>Naming <span class="hljs-keyword">and </span><span class="hljs-keyword">Directory </span>Interface的缩写，是<span class="hljs-keyword">Java提供的一种标准的API，用于访问命名和目录服务。JNDI提供了一种统一的方式来查找和访问各种命名服务，如目录服务、命名空间、配置信息等。</span><br><span class="hljs-keyword"></span><br>具体来说，<span class="hljs-keyword">JNDI的主要作用包括：</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">1</span>. 命名服务：<span class="hljs-keyword">JNDI可以用于访问和管理命名服务，如LDAP（轻量级目录访问协议）服务器、DNS（域名系统）等。它提供了一组API，可以通过名称来查找和获取对象，实现对象的命名和查找功能。</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">2</span>. 目录服务：<span class="hljs-keyword">JNDI可以用于访问和管理目录服务，如LDAP目录服务器。它提供了一组API，可以对目录中的条目进行增删改查操作，实现目录的管理和维护功能。</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">3</span>. 配置信息：<span class="hljs-keyword">JNDI可以用于访问和管理配置信息，如数据库连接信息、资源配置等。它可以将配置信息存储在命名服务中，并通过JNDI </span>API进行访问和获取，实现配置信息的统一管理和动态更新。<br><br><span class="hljs-number">4</span>. 分布式对象：<span class="hljs-keyword">JNDI可以用于查找和获取分布式对象，如EJB（企业JavaBean）等。它提供了一组API，可以通过名称来查找和获取远程对象，实现分布式对象的访问和调用功能。</span><br><span class="hljs-keyword"></span><br>总结：<span class="hljs-keyword">JNDI是Java提供的一种标准API，用于访问命名和目录服务。它可以用于访问和管理命名服务、目录服务、配置信息和分布式对象等，提供了一种统一的方式来查找和访问各种命名服务。</span><br></code></pre></td></tr></table></figure>



<h2 id="JMH（基准测试）"><a href="#JMH（基准测试）" class="headerlink" title="JMH（基准测试）"></a>JMH（基准测试）</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">JMH（Java </span>Microbenchmark Harness）是<span class="hljs-keyword">Java语言的一个基准测试框架，用于编写、运行和分析Java程序的性能基准测试。它是由OpenJDK项目提供的一个开源工具，旨在提供可靠、准确和可重复的性能测试环境。</span><br><span class="hljs-keyword"></span><br><span class="hljs-keyword">JMH的主要特点和功能包括：</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">1</span>. 提供丰富的基准测试注解：<span class="hljs-keyword">JMH提供了一组注解，用于定义基准测试方法、迭代次数、线程数等测试参数。这些注解可以帮助开发人员编写清晰、可读的基准测试代码。</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">2</span>. 自动化的基准测试运行：<span class="hljs-keyword">JMH可以自动化地运行基准测试，并提供准确的性能度量和统计数据。它会自动进行预热、测量和迭代，并输出详细的测试结果和报告。</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">3</span>. 微基准测试支持：<span class="hljs-keyword">JMH支持微基准测试，即对单个方法或代码片段进行性能测试。它可以精确地测量方法的执行时间、吞吐量、延迟等性能指标。</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">4</span>. 避免优化干扰：<span class="hljs-keyword">JMH会自动处理JIT（即时编译器）优化的干扰，以确保测试结果的准确性。它会使用黑盒测试的方式，避免编译器对测试代码进行过度优化。</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">5</span>. 高度可配置：<span class="hljs-keyword">JMH提供了丰富的配置选项，可以调整测试的参数和行为。开发人员可以根据需要设置测试的迭代次数、线程数、预热次数等，以及输出结果的格式和详细程度。</span><br><span class="hljs-keyword"></span><br>总结：<span class="hljs-keyword">JMH是Java语言的一个基准测试框架，用于编写、运行和分析Java程序的性能基准测试。它提供了丰富的基准测试注解、自动化的测试运行、微基准测试支持、避免优化干扰和高度可配置等功能，帮助开发人员准确、可靠地评估和优化Java程序的性能。</span><br></code></pre></td></tr></table></figure>



<h2 id="JMX（监控管理-Java程序）"><a href="#JMX（监控管理-Java程序）" class="headerlink" title="JMX（监控管理 Java程序）"></a>JMX（监控管理 Java程序）</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">JMX（Java </span>Management <span class="hljs-keyword">Extensions）是Java平台提供的一套管理和监控Java应用程序的标准API。它提供了一种标准化的方式来管理和监控Java应用程序的运行状态、性能指标和配置信息。</span><br><span class="hljs-keyword"></span><br><span class="hljs-keyword">JMX的主要特点和功能包括：</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">1</span>. MBean（Managed <span class="hljs-keyword">Bean）：JMX使用MBean作为管理和监控的基本单元。MBean是一种Java对象，通过暴露一组操作和属性来提供管理和监控功能。</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">2</span>. <span class="hljs-keyword">JMX代理：JMX提供了代理机制，允许远程管理和监控Java应用程序。通过JMX代理，可以在远程机器上访问和操作应用程序的MBean。</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">3</span>. 通信协议：<span class="hljs-keyword">JMX支持多种通信协议，如RMI（远程方法调用）、HTTP、SNMP（简单网络管理协议）等。这些协议可以用于在不同的环境中进行管理和监控操作。</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">4</span>. <span class="hljs-keyword">JMX连接：JMX连接是通过JMX连接器建立的，它允许管理和监控工具与Java应用程序进行通信。常见的JMX连接器包括RMI连接器、HTTP连接器和JMXMP连接器。</span><br><span class="hljs-keyword"></span><br><span class="hljs-number">5</span>. <span class="hljs-keyword">JMX管理工具：JMX提供了一些管理和监控工具，如JConsole、VisualVM等。这些工具可以连接到Java应用程序的JMX代理，提供可视化的界面来查看和操作MBean。</span><br><span class="hljs-keyword"></span><br>总结：<span class="hljs-keyword">JMX是Java平台提供的一套管理和监控Java应用程序的标准API。它使用MBean作为管理和监控的基本单元，提供了代理机制和多种通信协议，允许远程管理和监控Java应用程序。通过JMX连接器建立连接，可以使用JMX管理工具来查看和操作应用程序的MBean。</span><br></code></pre></td></tr></table></figure>



<h1 id="————《Spring-Boot》————"><a href="#————《Spring-Boot》————" class="headerlink" title="————《Spring Boot》————"></a>————《Spring Boot》————</h1><h1 id="第一部分-Spring-Boot"><a href="#第一部分-Spring-Boot" class="headerlink" title="第一部分 Spring Boot"></a>第一部分 Spring Boot</h1><h1 id="第一章-事件监听机制"><a href="#第一章-事件监听机制" class="headerlink" title="第一章 事件监听机制"></a>第一章 事件监听机制</h1><h1 id="1-1-Listener-监听者"><a href="#1-1-Listener-监听者" class="headerlink" title="1.1 Listener - 监听者"></a>1.1 Listener - 监听者</h1><h2 id="ApplicationListener-Spring-Context"><a href="#ApplicationListener-Spring-Context" class="headerlink" title="ApplicationListener - Spring Context"></a>ApplicationListener - Spring Context</h2><p>由Spring Context 管理的监听者，最终执行 回调方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApplicationListener</span>&lt;E <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ApplicationEvent</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">EventListener</span> &#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Handle an application event.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> event the event to respond to</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">onApplicationEvent</span><span class="hljs-params">(E event)</span>;<br><br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Create a new &#123;<span class="hljs-doctag">@code</span> ApplicationListener&#125; for the given payload consumer.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> consumer the event payload consumer</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> &lt;T&gt; the type of the event payload</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> a corresponding &#123;<span class="hljs-doctag">@code</span> ApplicationListener&#125; instance</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.3</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> PayloadApplicationEvent</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">static</span> &lt;T&gt; ApplicationListener&lt;PayloadApplicationEvent&lt;T&gt;&gt; <span class="hljs-title function_">forPayload</span><span class="hljs-params">(Consumer&lt;T&gt; consumer)</span> &#123;<br>		<span class="hljs-keyword">return</span> event -&gt; consumer.accept(event.getPayload());<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="SpringApplicationRunListener-Spring-Boot-Event"><a href="#SpringApplicationRunListener-Spring-Boot-Event" class="headerlink" title="SpringApplicationRunListener - Spring Boot - Event"></a>SpringApplicationRunListener - Spring Boot - Event</h2><p><strong>定义回调方法（类似于事件 – 与listener没关系）</strong></p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">作用：定义回调方法，在Spring <span class="hljs-keyword">Boot初始化过程中，通过调用方法，通过 </span>EventPublishingRunListener 方法，持有Spring <span class="hljs-built_in">Context</span> 的<span class="hljs-keyword">Multicast </span>广播器，通知具体的 listener执行<br></code></pre></td></tr></table></figure>



<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs arduino">包含的事件：（这些事件可以对应Spring Boot的启动流程）<br>  <span class="hljs-number">1</span>、starting<br>  <span class="hljs-number">2</span>、environmentPrepared<br>	<span class="hljs-number">3</span>、contextPrepared<br>  <span class="hljs-number">4</span>、contextLoaded<br>  <span class="hljs-number">5</span>、started<br>  <span class="hljs-number">6</span>、ready<br>  <span class="hljs-number">7</span>、failed<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> ConfigurableApplicationContext <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> &#123;<br>	<span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.nanoTime();<br>	<span class="hljs-type">DefaultBootstrapContext</span> <span class="hljs-variable">bootstrapContext</span> <span class="hljs-operator">=</span> createBootstrapContext();<br>	<span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>	configureHeadlessProperty();<br>	<span class="hljs-type">SpringApplicationRunListeners</span> <span class="hljs-variable">listeners</span> <span class="hljs-operator">=</span> getRunListeners(args);<br>   <span class="hljs-comment">// 1、starting</span><br>	listeners.starting(bootstrapContext, <span class="hljs-built_in">this</span>.mainApplicationClass);<br>	<span class="hljs-keyword">try</span> &#123;<br>		<span class="hljs-type">ApplicationArguments</span> <span class="hljs-variable">applicationArguments</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultApplicationArguments</span>(args);<br>     <span class="hljs-comment">// 2、environmentPrepared</span><br>		<span class="hljs-type">ConfigurableEnvironment</span> <span class="hljs-variable">environment</span> <span class="hljs-operator">=</span> prepareEnvironment(listeners, bootstrapContext, applicationArguments);<br>		configureIgnoreBeanInfo(environment);<br>		<span class="hljs-type">Banner</span> <span class="hljs-variable">printedBanner</span> <span class="hljs-operator">=</span> printBanner(environment);<br>		context = createApplicationContext();<br>		context.setApplicationStartup(<span class="hljs-built_in">this</span>.applicationStartup);<br>     <span class="hljs-comment">// 3、contextPrepared  --- 4、contextLoaded</span><br>		prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);<br>		refreshContext(context);<br>		afterRefresh(context, applicationArguments);<br>		<span class="hljs-type">Duration</span> <span class="hljs-variable">timeTakenToStartup</span> <span class="hljs-operator">=</span> Duration.ofNanos(System.nanoTime() - startTime);<br>		<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.logStartupInfo) &#123;<br>			<span class="hljs-keyword">new</span> <span class="hljs-title class_">StartupInfoLogger</span>(<span class="hljs-built_in">this</span>.mainApplicationClass).logStarted(getApplicationLog(), timeTakenToStartup);<br>		&#125;<br>     <span class="hljs-comment">// 5、started</span><br>		listeners.started(context, timeTakenToStartup);<br>		callRunners(context, applicationArguments);<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>		handleRunFailure(context, ex, listeners);<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(ex);<br>	&#125;<br>	<span class="hljs-keyword">try</span> &#123;<br>		<span class="hljs-type">Duration</span> <span class="hljs-variable">timeTakenToReady</span> <span class="hljs-operator">=</span> Duration.ofNanos(System.nanoTime() - startTime);<br>     <span class="hljs-comment">// 6、ready</span><br>		listeners.ready(context, timeTakenToReady);<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>     <span class="hljs-comment">// 7、failed</span><br>		handleRunFailure(context, ex, <span class="hljs-literal">null</span>);<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(ex);<br>	&#125;<br>	<span class="hljs-keyword">return</span> context;<br>&#125;<br></code></pre></td></tr></table></figure>





<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SpringApplicationRunListener</span> &#123;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Called immediately when the run method has first started. Can be used for very</span><br><span class="hljs-comment">    * early initialization.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> bootstrapContext the bootstrap context</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">starting</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext)</span> &#123;<br>   &#125;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Called once the environment has been prepared, but before the</span><br><span class="hljs-comment">    * &#123;<span class="hljs-doctag">@link</span> ApplicationContext&#125; has been created.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> bootstrapContext the bootstrap context</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> environment the environment</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">environmentPrepared</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext,</span><br><span class="hljs-params">         ConfigurableEnvironment environment)</span> &#123;<br>   &#125;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Called once the &#123;<span class="hljs-doctag">@link</span> ApplicationContext&#125; has been created and prepared, but</span><br><span class="hljs-comment">    * before sources have been loaded.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> context the application context</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextPrepared</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>   &#125;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Called once the application context has been loaded but before it has been</span><br><span class="hljs-comment">    * refreshed.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> context the application context</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoaded</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>   &#125;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * The context has been refreshed and the application has started but</span><br><span class="hljs-comment">    * &#123;<span class="hljs-doctag">@link</span> CommandLineRunner CommandLineRunners&#125; and &#123;<span class="hljs-doctag">@link</span> ApplicationRunner</span><br><span class="hljs-comment">    * ApplicationRunners&#125; have not been called.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> context the application context.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> timeTaken the time taken to start the application or &#123;<span class="hljs-doctag">@code</span> null&#125; if unknown</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@since</span> 2.6.0</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">started</span><span class="hljs-params">(ConfigurableApplicationContext context, Duration timeTaken)</span> &#123;<br>      started(context);<br>   &#125;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * The context has been refreshed and the application has started but</span><br><span class="hljs-comment">    * &#123;<span class="hljs-doctag">@link</span> CommandLineRunner CommandLineRunners&#125; and &#123;<span class="hljs-doctag">@link</span> ApplicationRunner</span><br><span class="hljs-comment">    * ApplicationRunners&#125; have not been called.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> context the application context.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@since</span> 2.0.0</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@deprecated</span> since 2.6.0 for removal in 3.0.0 in favor of</span><br><span class="hljs-comment">    * &#123;<span class="hljs-doctag">@link</span> #started(ConfigurableApplicationContext, Duration)&#125;</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Deprecated</span><br>   <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">started</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>   &#125;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Called immediately before the run method finishes, when the application context has</span><br><span class="hljs-comment">    * been refreshed and all &#123;<span class="hljs-doctag">@link</span> CommandLineRunner CommandLineRunners&#125; and</span><br><span class="hljs-comment">    * &#123;<span class="hljs-doctag">@link</span> ApplicationRunner ApplicationRunners&#125; have been called.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> context the application context.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> timeTaken the time taken for the application to be ready or &#123;<span class="hljs-doctag">@code</span> null&#125; if</span><br><span class="hljs-comment">    * unknown</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@since</span> 2.6.0</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ready</span><span class="hljs-params">(ConfigurableApplicationContext context, Duration timeTaken)</span> &#123;<br>      running(context);<br>   &#125;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Called immediately before the run method finishes, when the application context has</span><br><span class="hljs-comment">    * been refreshed and all &#123;<span class="hljs-doctag">@link</span> CommandLineRunner CommandLineRunners&#125; and</span><br><span class="hljs-comment">    * &#123;<span class="hljs-doctag">@link</span> ApplicationRunner ApplicationRunners&#125; have been called.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> context the application context.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@since</span> 2.0.0</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@deprecated</span> since 2.6.0 for removal in 3.0.0 in favor of</span><br><span class="hljs-comment">    * &#123;<span class="hljs-doctag">@link</span> #ready(ConfigurableApplicationContext, Duration)&#125;</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Deprecated</span><br>   <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">running</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>   &#125;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Called when a failure occurs when running the application.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> context the application context or &#123;<span class="hljs-doctag">@code</span> null&#125; if a failure occurred before</span><br><span class="hljs-comment">    * the context was created</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> exception the failure</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@since</span> 2.0.0</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">failed</span><span class="hljs-params">(ConfigurableApplicationContext context, Throwable exception)</span> &#123;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="具体实现-EventPublishingRunListener-–-Spring-Boot"><a href="#具体实现-EventPublishingRunListener-–-Spring-Boot" class="headerlink" title="具体实现 EventPublishingRunListener – Spring Boot"></a>具体实现 EventPublishingRunListener – Spring Boot</h3><p>广播通知 所有的事件 （start 、environmentPrepared、等）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventPublishingRunListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SpringApplicationRunListener</span>, Ordered &#123;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SpringApplication application;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String[] args;<br>	<span class="hljs-comment">// 持有Context 的 multicast，通过它广播Spring Boot的事件</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SimpleApplicationEventMulticaster initialMulticaster;<br><br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">EventPublishingRunListener</span><span class="hljs-params">(SpringApplication application, String[] args)</span> &#123;<br>		<span class="hljs-built_in">this</span>.application = application;<br>		<span class="hljs-built_in">this</span>.args = args;<br>		<span class="hljs-built_in">this</span>.initialMulticaster = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleApplicationEventMulticaster</span>();<br>		<span class="hljs-keyword">for</span> (ApplicationListener&lt;?&gt; listener : application.getListeners()) &#123;<br>			<span class="hljs-built_in">this</span>.initialMulticaster.addApplicationListener(listener);<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">starting</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext)</span> &#123;<br>		<span class="hljs-built_in">this</span>.initialMulticaster<br>				.multicastEvent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationStartingEvent</span>(bootstrapContext, <span class="hljs-built_in">this</span>.application, <span class="hljs-built_in">this</span>.args));<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">environmentPrepared</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext,</span><br><span class="hljs-params">			ConfigurableEnvironment environment)</span> &#123;<br>		<span class="hljs-built_in">this</span>.initialMulticaster.multicastEvent(<br>				<span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationEnvironmentPreparedEvent</span>(bootstrapContext, <span class="hljs-built_in">this</span>.application, <span class="hljs-built_in">this</span>.args, environment));<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextPrepared</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>		<span class="hljs-built_in">this</span>.initialMulticaster<br>				.multicastEvent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationContextInitializedEvent</span>(<span class="hljs-built_in">this</span>.application, <span class="hljs-built_in">this</span>.args, context));<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoaded</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>		<span class="hljs-keyword">for</span> (ApplicationListener&lt;?&gt; listener : <span class="hljs-built_in">this</span>.application.getListeners()) &#123;<br>			<span class="hljs-keyword">if</span> (listener <span class="hljs-keyword">instanceof</span> ApplicationContextAware) &#123;<br>				((ApplicationContextAware) listener).setApplicationContext(context);<br>			&#125;<br>			context.addApplicationListener(listener);<br>		&#125;<br>		<span class="hljs-built_in">this</span>.initialMulticaster.multicastEvent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationPreparedEvent</span>(<span class="hljs-built_in">this</span>.application, <span class="hljs-built_in">this</span>.args, context));<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">started</span><span class="hljs-params">(ConfigurableApplicationContext context, Duration timeTaken)</span> &#123;<br>		context.publishEvent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationStartedEvent</span>(<span class="hljs-built_in">this</span>.application, <span class="hljs-built_in">this</span>.args, context, timeTaken));<br>		AvailabilityChangeEvent.publish(context, LivenessState.CORRECT);<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ready</span><span class="hljs-params">(ConfigurableApplicationContext context, Duration timeTaken)</span> &#123;<br>		context.publishEvent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationReadyEvent</span>(<span class="hljs-built_in">this</span>.application, <span class="hljs-built_in">this</span>.args, context, timeTaken));<br>		AvailabilityChangeEvent.publish(context, ReadinessState.ACCEPTING_TRAFFIC);<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">failed</span><span class="hljs-params">(ConfigurableApplicationContext context, Throwable exception)</span> &#123;<br>		<span class="hljs-type">ApplicationFailedEvent</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationFailedEvent</span>(<span class="hljs-built_in">this</span>.application, <span class="hljs-built_in">this</span>.args, context, exception);<br>		<span class="hljs-keyword">if</span> (context != <span class="hljs-literal">null</span> &amp;&amp; context.isActive()) &#123;<br>			<span class="hljs-comment">// Listeners have been registered to the application context so we should</span><br>			<span class="hljs-comment">// use it at this point if we can</span><br>			context.publishEvent(event);<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-comment">// An inactive context may not have a multicaster so we use our multicaster to</span><br>			<span class="hljs-comment">// call all the context&#x27;s listeners instead</span><br>			<span class="hljs-keyword">if</span> (context <span class="hljs-keyword">instanceof</span> AbstractApplicationContext) &#123;<br>				<span class="hljs-keyword">for</span> (ApplicationListener&lt;?&gt; listener : ((AbstractApplicationContext) context)<br>						.getApplicationListeners()) &#123;<br>					<span class="hljs-built_in">this</span>.initialMulticaster.addApplicationListener(listener);<br>				&#125;<br>			&#125;<br>			<span class="hljs-built_in">this</span>.initialMulticaster.setErrorHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingErrorHandler</span>());<br>			<span class="hljs-built_in">this</span>.initialMulticaster.multicastEvent(event);<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingErrorHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ErrorHandler</span> &#123;<br><br>		<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Log</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LogFactory.getLog(EventPublishingRunListener.class);<br><br>		<span class="hljs-meta">@Override</span><br>		<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleError</span><span class="hljs-params">(Throwable throwable)</span> &#123;<br>			logger.warn(<span class="hljs-string">&quot;Error calling ApplicationEventListener&quot;</span>, throwable);<br>		&#125;<br><br>	&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>



<h4 id="创建-通知事件-Event"><a href="#创建-通知事件-Event" class="headerlink" title="创建 通知事件 Event"></a>创建 通知事件 Event</h4><p><img src="https://raw.githubusercontent.com/wherezy1/PicGOImageShack/main/images/image-20230723170427758.png" srcset="/img/loading.gif" lazyload alt="image-20230723170427758"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ApplicationPreparedEvent</span><br><span class="hljs-built_in">this</span>.initialMulticaster.multicastEvent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationPreparedEvent</span>(<span class="hljs-built_in">this</span>.application, <span class="hljs-built_in">this</span>.args, context));<br></code></pre></td></tr></table></figure>

<h3 id="ApplicationPreparedEvent-–-gt-ApplicationEvent-x3D-x3D-Spring-Context"><a href="#ApplicationPreparedEvent-–-gt-ApplicationEvent-x3D-x3D-Spring-Context" class="headerlink" title="ApplicationPreparedEvent –&gt; ApplicationEvent  &#x3D;&#x3D; Spring Context"></a>ApplicationPreparedEvent –&gt; ApplicationEvent  &#x3D;&#x3D; Spring Context</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationPreparedEvent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SpringApplicationEvent</span> &#123;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConfigurableApplicationContext context;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Create a new &#123;<span class="hljs-doctag">@link</span> ApplicationPreparedEvent&#125; instance.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> application the current application</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> args the arguments the application is running with</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> context the ApplicationContext about to be refreshed</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">ApplicationPreparedEvent</span><span class="hljs-params">(SpringApplication application, String[] args,</span><br><span class="hljs-params">			ConfigurableApplicationContext context)</span> &#123;<br>		<span class="hljs-built_in">super</span>(application, args);<br>		<span class="hljs-built_in">this</span>.context = context;<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the application context.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the context</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> ConfigurableApplicationContext <span class="hljs-title function_">getApplicationContext</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.context;<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h4 id="通过事件找到-ApplicationListener"><a href="#通过事件找到-ApplicationListener" class="headerlink" title="通过事件找到 ApplicationListener"></a>通过事件找到 ApplicationListener</h4><p>并调用onApplicationEvent() 方法</p>
<p>SimpleApplicationEventMulticaster</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleApplicationEventMulticaster</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractApplicationEventMulticaster</span> &#123;<br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">private</span> Executor taskExecutor;<br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">private</span> ErrorHandler errorHandler;<br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Log lazyLogger;<br>	<br>  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invokeListener</span><span class="hljs-params">(ApplicationListener&lt;?&gt; listener, ApplicationEvent event)</span> &#123;<br>		<span class="hljs-type">ErrorHandler</span> <span class="hljs-variable">errorHandler</span> <span class="hljs-operator">=</span> getErrorHandler();<br>		<span class="hljs-keyword">if</span> (errorHandler != <span class="hljs-literal">null</span>) &#123;<br>			<span class="hljs-keyword">try</span> &#123;<br>				doInvokeListener(listener, event);<br>			&#125;<br>			<span class="hljs-keyword">catch</span> (Throwable err) &#123;<br>				errorHandler.handleError(err);<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			doInvokeListener(listener, event);<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="SpringApplicationRunListeners"><a href="#SpringApplicationRunListeners" class="headerlink" title="SpringApplicationRunListeners"></a>SpringApplicationRunListeners</h2><p>回调方法的 注册具体的调用入口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringApplicationRunListeners</span> &#123;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Log log;<br>	<span class="hljs-comment">// 保存注册的 listeners</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;SpringApplicationRunListener&gt; listeners;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ApplicationStartup applicationStartup;<br><br>	SpringApplicationRunListeners(Log log, Collection&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SpringApplicationRunListener</span>&gt; listeners,<br>			ApplicationStartup applicationStartup) &#123;<br>		<span class="hljs-built_in">this</span>.log = log;<br>		<span class="hljs-built_in">this</span>.listeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(listeners);<br>		<span class="hljs-built_in">this</span>.applicationStartup = applicationStartup;<br>	&#125;<br><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">starting</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext, Class&lt;?&gt; mainApplicationClass)</span> &#123;<br>		doWithListeners(<span class="hljs-string">&quot;spring.boot.application.starting&quot;</span>, (listener) -&gt; listener.starting(bootstrapContext),<br>				(step) -&gt; &#123;<br>					<span class="hljs-keyword">if</span> (mainApplicationClass != <span class="hljs-literal">null</span>) &#123;<br>						step.tag(<span class="hljs-string">&quot;mainApplicationClass&quot;</span>, mainApplicationClass.getName());<br>					&#125;<br>				&#125;);<br>	&#125;<br><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">environmentPrepared</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext, ConfigurableEnvironment environment)</span> &#123;<br>		doWithListeners(<span class="hljs-string">&quot;spring.boot.application.environment-prepared&quot;</span>,<br>				(listener) -&gt; listener.environmentPrepared(bootstrapContext, environment));<br>	&#125;<br><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">contextPrepared</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>		doWithListeners(<span class="hljs-string">&quot;spring.boot.application.context-prepared&quot;</span>, (listener) -&gt; listener.contextPrepared(context));<br>	&#125;<br><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoaded</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> &#123;<br>		doWithListeners(<span class="hljs-string">&quot;spring.boot.application.context-loaded&quot;</span>, (listener) -&gt; listener.contextLoaded(context));<br>	&#125;<br><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">started</span><span class="hljs-params">(ConfigurableApplicationContext context, Duration timeTaken)</span> &#123;<br>		doWithListeners(<span class="hljs-string">&quot;spring.boot.application.started&quot;</span>, (listener) -&gt; listener.started(context, timeTaken));<br>	&#125;<br><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">ready</span><span class="hljs-params">(ConfigurableApplicationContext context, Duration timeTaken)</span> &#123;<br>		doWithListeners(<span class="hljs-string">&quot;spring.boot.application.ready&quot;</span>, (listener) -&gt; listener.ready(context, timeTaken));<br>	&#125;<br><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">failed</span><span class="hljs-params">(ConfigurableApplicationContext context, Throwable exception)</span> &#123;<br>		doWithListeners(<span class="hljs-string">&quot;spring.boot.application.failed&quot;</span>,<br>				(listener) -&gt; callFailedListener(listener, context, exception), (step) -&gt; &#123;<br>					step.tag(<span class="hljs-string">&quot;exception&quot;</span>, exception.getClass().toString());<br>					step.tag(<span class="hljs-string">&quot;message&quot;</span>, exception.getMessage());<br>				&#125;);<br>	&#125;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">callFailedListener</span><span class="hljs-params">(SpringApplicationRunListener listener, ConfigurableApplicationContext context,</span><br><span class="hljs-params">			Throwable exception)</span> &#123;<br>		<span class="hljs-keyword">try</span> &#123;<br>			listener.failed(context, exception);<br>		&#125;<br>		<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>			<span class="hljs-keyword">if</span> (exception == <span class="hljs-literal">null</span>) &#123;<br>				ReflectionUtils.rethrowRuntimeException(ex);<br>			&#125;<br>			<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.log.isDebugEnabled()) &#123;<br>				<span class="hljs-built_in">this</span>.log.error(<span class="hljs-string">&quot;Error handling failed&quot;</span>, ex);<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				<span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> ex.getMessage();<br>				message = (message != <span class="hljs-literal">null</span>) ? message : <span class="hljs-string">&quot;no error message&quot;</span>;<br>				<span class="hljs-built_in">this</span>.log.warn(<span class="hljs-string">&quot;Error handling failed (&quot;</span> + message + <span class="hljs-string">&quot;)&quot;</span>);<br>			&#125;<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWithListeners</span><span class="hljs-params">(String stepName, Consumer&lt;SpringApplicationRunListener&gt; listenerAction)</span> &#123;<br>		doWithListeners(stepName, listenerAction, <span class="hljs-literal">null</span>);<br>	&#125;<br>	<span class="hljs-comment">/// 调用 所有listener 执行 listener 的 方法（对应的方法）</span><br>  <span class="hljs-comment">//Consumer:</span><br>  <span class="hljs-comment">// forEach(listenerAction)</span><br>  <span class="hljs-comment">// listenerAction.accept(listener);</span><br>  <span class="hljs-comment">// (listener) -&gt; listener.ready(context, timeTaken) // 假设 调用ready </span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWithListeners</span><span class="hljs-params">(String stepName, Consumer&lt;SpringApplicationRunListener&gt; listenerAction,</span><br><span class="hljs-params">			Consumer&lt;StartupStep&gt; stepAction)</span> &#123;<br>		<span class="hljs-type">StartupStep</span> <span class="hljs-variable">step</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.applicationStartup.start(stepName);<br>		<span class="hljs-built_in">this</span>.listeners.forEach(listenerAction);<br>		<span class="hljs-keyword">if</span> (stepAction != <span class="hljs-literal">null</span>) &#123;<br>			stepAction.accept(step);<br>		&#125;<br>		step.end();<br>	&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>



<h1 id="1-2-Multicaster-广播-–-Spring-Context"><a href="#1-2-Multicaster-广播-–-Spring-Context" class="headerlink" title="1.2 Multicaster - 广播 – Spring Context"></a>1.2 Multicaster - 广播 – Spring Context</h1><h2 id="ApplicationEventMulticaster-–-Spring-Boot"><a href="#ApplicationEventMulticaster-–-Spring-Boot" class="headerlink" title="ApplicationEventMulticaster – Spring Boot"></a>ApplicationEventMulticaster – Spring Boot</h2><p>管理 LIstener</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApplicationEventMulticaster</span> &#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Add a listener to be notified of all events.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> listener the listener to add</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #removeApplicationListener(ApplicationListener)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #removeApplicationListeners(Predicate)</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">addApplicationListener</span><span class="hljs-params">(ApplicationListener&lt;?&gt; listener)</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Add a listener bean to be notified of all events.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> listenerBeanName the name of the listener bean to add</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #removeApplicationListenerBean(String)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #removeApplicationListenerBeans(Predicate)</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">addApplicationListenerBean</span><span class="hljs-params">(String listenerBeanName)</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Remove a listener from the notification list.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> listener the listener to remove</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #addApplicationListener(ApplicationListener)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #removeApplicationListeners(Predicate)</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">removeApplicationListener</span><span class="hljs-params">(ApplicationListener&lt;?&gt; listener)</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Remove a listener bean from the notification list.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> listenerBeanName the name of the listener bean to remove</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #addApplicationListenerBean(String)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #removeApplicationListenerBeans(Predicate)</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">removeApplicationListenerBean</span><span class="hljs-params">(String listenerBeanName)</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Remove all matching listeners from the set of registered</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@code</span> ApplicationListener&#125; instances (which includes adapter classes</span><br><span class="hljs-comment">	 * such as &#123;<span class="hljs-doctag">@link</span> ApplicationListenerMethodAdapter&#125;, e.g. for annotated</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@link</span> EventListener&#125; methods).</span><br><span class="hljs-comment">	 * &lt;p&gt;Note: This just applies to instance registrations, not to listeners</span><br><span class="hljs-comment">	 * registered by bean name.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> predicate the predicate to identify listener instances to remove,</span><br><span class="hljs-comment">	 * e.g. checking &#123;<span class="hljs-doctag">@link</span> SmartApplicationListener#getListenerId()&#125;</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.3.5</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #addApplicationListener(ApplicationListener)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #removeApplicationListener(ApplicationListener)</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">removeApplicationListeners</span><span class="hljs-params">(Predicate&lt;ApplicationListener&lt;?&gt;&gt; predicate)</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Remove all matching listener beans from the set of registered</span><br><span class="hljs-comment">	 * listener bean names (referring to bean classes which in turn</span><br><span class="hljs-comment">	 * implement the &#123;<span class="hljs-doctag">@link</span> ApplicationListener&#125; interface directly).</span><br><span class="hljs-comment">	 * &lt;p&gt;Note: This just applies to bean name registrations, not to</span><br><span class="hljs-comment">	 * programmatically registered &#123;<span class="hljs-doctag">@code</span> ApplicationListener&#125; instances.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> predicate the predicate to identify listener bean names to remove</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.3.5</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #addApplicationListenerBean(String)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #removeApplicationListenerBean(String)</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">removeApplicationListenerBeans</span><span class="hljs-params">(Predicate&lt;String&gt; predicate)</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Remove all listeners registered with this multicaster.</span><br><span class="hljs-comment">	 * &lt;p&gt;After a remove call, the multicaster will perform no action</span><br><span class="hljs-comment">	 * on event notification until new listeners are registered.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #removeApplicationListeners(Predicate)</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">removeAllListeners</span><span class="hljs-params">()</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Multicast the given application event to appropriate listeners.</span><br><span class="hljs-comment">	 * &lt;p&gt;Consider using &#123;<span class="hljs-doctag">@link</span> #multicastEvent(ApplicationEvent, ResolvableType)&#125;</span><br><span class="hljs-comment">	 * if possible as it provides better support for generics-based events.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> event the event to multicast</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">multicastEvent</span><span class="hljs-params">(ApplicationEvent event)</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Multicast the given application event to appropriate listeners.</span><br><span class="hljs-comment">	 * &lt;p&gt;If the &#123;<span class="hljs-doctag">@code</span> eventType&#125; is &#123;<span class="hljs-doctag">@code</span> null&#125;, a default type is built</span><br><span class="hljs-comment">	 * based on the &#123;<span class="hljs-doctag">@code</span> event&#125; instance.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> event the event to multicast</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> eventType the type of event (can be &#123;<span class="hljs-doctag">@code</span> null&#125;)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 4.2</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">multicastEvent</span><span class="hljs-params">(ApplicationEvent event, <span class="hljs-meta">@Nullable</span> ResolvableType eventType)</span>;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>



<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-string">``</span><span class="hljs-string">`</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"># 1.3 Event</span><br><span class="hljs-string"></span><br><span class="hljs-string">## ApplicationEvent</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">## SpringApplicationEvent</span><br><span class="hljs-string"></span><br><span class="hljs-string">`</span><span class="hljs-string">``</span>java<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringApplicationEvent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ApplicationEvent</span> &#123;<br><br>   <span class="hljs-keyword">private</span> final <span class="hljs-title class_">String</span>[] args;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title class_">SpringApplicationEvent</span>(<span class="hljs-title class_">SpringApplication</span> application, <span class="hljs-title class_">String</span>[] args) &#123;<br>      <span class="hljs-variable language_">super</span>(application);<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">args</span> = args;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title class_">SpringApplication</span> <span class="hljs-title function_">getSpringApplication</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">return</span> (<span class="hljs-title class_">SpringApplication</span>) <span class="hljs-title function_">getSource</span>();<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> final <span class="hljs-title class_">String</span>[] <span class="hljs-title function_">getArgs</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">args</span>;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>





<h1 id="第二章-环境加载-–-Spring-Boot"><a href="#第二章-环境加载-–-Spring-Boot" class="headerlink" title="第二章 环境加载 – Spring Boot"></a>第二章 环境加载 – Spring Boot</h1><h1 id="2-1-EnvironmentPostProcessor-Boot"><a href="#2-1-EnvironmentPostProcessor-Boot" class="headerlink" title="2.1 EnvironmentPostProcessor - Boot -"></a>2.1 EnvironmentPostProcessor - Boot -</h1><p><img src="https://raw.githubusercontent.com/wherezy1/PicGOImageShack/main/images/image-20230723171852456.png" srcset="/img/loading.gif" lazyload alt="image-20230723171852456"></p>
<p>Spring boot 注册到Spring Framework 到容器中，进行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">EnvironmentPostProcessor</span> &#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Post-process the given &#123;<span class="hljs-doctag">@code</span> environment&#125;.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> environment the environment to post-process</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> application the application to which the environment belongs</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessEnvironment</span><span class="hljs-params">(ConfigurableEnvironment environment, SpringApplication application)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># Environment Post Processors</span><br><span class="hljs-attr">org.springframework.boot.env.EnvironmentPostProcessor</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.cloud.CloudFoundryVcapEnvironmentPostProcessor,\</span><br><span class="hljs-string">org.springframework.boot.context.config.ConfigDataEnvironmentPostProcessor,\</span><br><span class="hljs-string">org.springframework.boot.env.RandomValuePropertySourceEnvironmentPostProcessor,\</span><br><span class="hljs-string">org.springframework.boot.env.SpringApplicationJsonEnvironmentPostProcessor,\</span><br><span class="hljs-string">org.springframework.boot.env.SystemEnvironmentPropertySourceEnvironmentPostProcessor,\</span><br><span class="hljs-string">org.springframework.boot.reactor.DebugAgentEnvironmentPostProcessor</span><br></code></pre></td></tr></table></figure>



<h2 id="IntegrationPropertiesEnvironmentPostProcessor"><a href="#IntegrationPropertiesEnvironmentPostProcessor" class="headerlink" title="IntegrationPropertiesEnvironmentPostProcessor"></a>IntegrationPropertiesEnvironmentPostProcessor</h2><p>继承EnvironmentPostProcessor， 初始化加载 PropertiesPropertySourceLoader</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IntegrationPropertiesEnvironmentPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EnvironmentPostProcessor</span>, Ordered &#123;<br>	<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerIntegrationPropertiesPropertySource</span><span class="hljs-params">(ConfigurableEnvironment environment, Resource resource)</span> &#123;<br>		<span class="hljs-type">PropertiesPropertySourceLoader</span> <span class="hljs-variable">loader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PropertiesPropertySourceLoader</span>();<br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-type">OriginTrackedMapPropertySource</span> <span class="hljs-variable">propertyFileSource</span> <span class="hljs-operator">=</span> (OriginTrackedMapPropertySource) loader<br>					.load(<span class="hljs-string">&quot;META-INF/spring.integration.properties&quot;</span>, resource).get(<span class="hljs-number">0</span>);<br>			environment.getPropertySources().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IntegrationPropertiesPropertySource</span>(propertyFileSource));<br>		&#125;<br>		<span class="hljs-keyword">catch</span> (IOException ex) &#123;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;Failed to load integration properties from &quot;</span> + resource, ex);<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h1 id="1-2-PropertySourceLoader-加载器"><a href="#1-2-PropertySourceLoader-加载器" class="headerlink" title="1.2 PropertySourceLoader - 加载器"></a>1.2 PropertySourceLoader - 加载器</h1><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># PropertySource Loaders</span><br><span class="hljs-attr">org.springframework.boot.env.PropertySourceLoader</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.env.PropertiesPropertySourceLoader,\</span><br><span class="hljs-string">org.springframework.boot.env.YamlPropertySourceLoader</span><br></code></pre></td></tr></table></figure>



<h2 id="PropertiesPropertySourceLoader"><a href="#PropertiesPropertySourceLoader" class="headerlink" title="PropertiesPropertySourceLoader"></a>PropertiesPropertySourceLoader</h2><p>加载 Properties &#x3D;&#x3D;  .xml   .properties</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PropertiesPropertySourceLoader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PropertySourceLoader</span> &#123;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">XML_FILE_EXTENSION</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;.xml&quot;</span>;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> String[] getFileExtensions() &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123; <span class="hljs-string">&quot;properties&quot;</span>, <span class="hljs-string">&quot;xml&quot;</span> &#125;;<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> List&lt;PropertySource&lt;?&gt;&gt; load(String name, Resource resource) <span class="hljs-keyword">throws</span> IOException &#123;<br>		List&lt;Map&lt;String, ?&gt;&gt; properties = loadProperties(resource);<br>		<span class="hljs-keyword">if</span> (properties.isEmpty()) &#123;<br>			<span class="hljs-keyword">return</span> Collections.emptyList();<br>		&#125;<br>		List&lt;PropertySource&lt;?&gt;&gt; propertySources = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(properties.size());<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; properties.size(); i++) &#123;<br>			<span class="hljs-type">String</span> <span class="hljs-variable">documentNumber</span> <span class="hljs-operator">=</span> (properties.size() != <span class="hljs-number">1</span>) ? <span class="hljs-string">&quot; (document #&quot;</span> + i + <span class="hljs-string">&quot;)&quot;</span> : <span class="hljs-string">&quot;&quot;</span>;<br>			propertySources.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OriginTrackedMapPropertySource</span>(name + documentNumber,<br>					Collections.unmodifiableMap(properties.get(i)), <span class="hljs-literal">true</span>));<br>		&#125;<br>		<span class="hljs-keyword">return</span> propertySources;<br>	&#125;<br><br>	<span class="hljs-meta">@SuppressWarnings(&#123; &quot;unchecked&quot;, &quot;rawtypes&quot; &#125;)</span><br>	<span class="hljs-keyword">private</span> List&lt;Map&lt;String, ?&gt;&gt; loadProperties(Resource resource) <span class="hljs-keyword">throws</span> IOException &#123;<br>		<span class="hljs-type">String</span> <span class="hljs-variable">filename</span> <span class="hljs-operator">=</span> resource.getFilename();<br>		List&lt;Map&lt;String, ?&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>		<span class="hljs-keyword">if</span> (filename != <span class="hljs-literal">null</span> &amp;&amp; filename.endsWith(XML_FILE_EXTENSION)) &#123;<br>			result.add((Map) PropertiesLoaderUtils.loadProperties(resource));<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			List&lt;Document&gt; documents = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OriginTrackedPropertiesLoader</span>(resource).load();<br>			documents.forEach((document) -&gt; result.add(document.asMap()));<br>		&#125;<br>		<span class="hljs-keyword">return</span> result;<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="YamlPropertySourceLoader"><a href="#YamlPropertySourceLoader" class="headerlink" title="YamlPropertySourceLoader"></a>YamlPropertySourceLoader</h2><p>加载 yml, yaml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YamlPropertySourceLoader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PropertySourceLoader</span> &#123;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> String[] getFileExtensions() &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123; <span class="hljs-string">&quot;yml&quot;</span>, <span class="hljs-string">&quot;yaml&quot;</span> &#125;;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> List&lt;PropertySource&lt;?&gt;&gt; load(String name, Resource resource) <span class="hljs-keyword">throws</span> IOException &#123;<br>      <span class="hljs-keyword">if</span> (!ClassUtils.isPresent(<span class="hljs-string">&quot;org.yaml.snakeyaml.Yaml&quot;</span>, getClass().getClassLoader())) &#123;<br>         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<br>               <span class="hljs-string">&quot;Attempted to load &quot;</span> + name + <span class="hljs-string">&quot; but snakeyaml was not found on the classpath&quot;</span>);<br>      &#125;<br>      List&lt;Map&lt;String, Object&gt;&gt; loaded = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OriginTrackedYamlLoader</span>(resource).load();<br>      <span class="hljs-keyword">if</span> (loaded.isEmpty()) &#123;<br>         <span class="hljs-keyword">return</span> Collections.emptyList();<br>      &#125;<br>      List&lt;PropertySource&lt;?&gt;&gt; propertySources = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(loaded.size());<br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; loaded.size(); i++) &#123;<br>         <span class="hljs-type">String</span> <span class="hljs-variable">documentNumber</span> <span class="hljs-operator">=</span> (loaded.size() != <span class="hljs-number">1</span>) ? <span class="hljs-string">&quot; (document #&quot;</span> + i + <span class="hljs-string">&quot;)&quot;</span> : <span class="hljs-string">&quot;&quot;</span>;<br>         propertySources.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OriginTrackedMapPropertySource</span>(name + documentNumber,<br>               Collections.unmodifiableMap(loaded.get(i)), <span class="hljs-literal">true</span>));<br>      &#125;<br>      <span class="hljs-keyword">return</span> propertySources;<br>   &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>





<h1 id="2-3-Listener"><a href="#2-3-Listener" class="headerlink" title="2.3 Listener"></a>2.3 Listener</h1><h2 id="EnvironmentPostProcessorApplicationListener-–Spring-boot"><a href="#EnvironmentPostProcessorApplicationListener-–Spring-boot" class="headerlink" title="EnvironmentPostProcessorApplicationListener –Spring boot"></a>EnvironmentPostProcessorApplicationListener –Spring boot</h2><h3 id="SmartApplicationListener-–Spring-Context"><a href="#SmartApplicationListener-–Spring-Context" class="headerlink" title="SmartApplicationListener. –Spring Context"></a>SmartApplicationListener. –Spring Context</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// SmartApplicationListener  -&gt; ApplicationListener</span><br><span class="hljs-comment">// 能够被 Spring Context 的listener 回调函数调用</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SmartApplicationListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ApplicationListener</span>&lt;ApplicationEvent&gt;, Ordered &#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Determine whether this listener actually supports the given event type.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> eventType the event type (never &#123;<span class="hljs-doctag">@code</span> null&#125;)</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsEventType</span><span class="hljs-params">(Class&lt;? extends ApplicationEvent&gt; eventType)</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Determine whether this listener actually supports the given source type.</span><br><span class="hljs-comment">	 * &lt;p&gt;The default implementation always returns &#123;<span class="hljs-doctag">@code</span> true&#125;.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> sourceType the source type, or &#123;<span class="hljs-doctag">@code</span> null&#125; if no source</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">default</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsSourceType</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Class&lt;?&gt; sourceType)</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Determine this listener&#x27;s order in a set of listeners for the same event.</span><br><span class="hljs-comment">	 * &lt;p&gt;The default implementation returns &#123;<span class="hljs-doctag">@link</span> #LOWEST_PRECEDENCE&#125;.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">default</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-keyword">return</span> LOWEST_PRECEDENCE;<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return an optional identifier for the listener.</span><br><span class="hljs-comment">	 * &lt;p&gt;The default value is an empty String.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.3.5</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> EventListener#id</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> ApplicationEventMulticaster#removeApplicationListeners</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">default</span> String <span class="hljs-title function_">getListenerId</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>	&#125;<br><br></code></pre></td></tr></table></figure>



<h3 id="EnvironmentPostProcessorApplicationListener"><a href="#EnvironmentPostProcessorApplicationListener" class="headerlink" title="EnvironmentPostProcessorApplicationListener"></a>EnvironmentPostProcessorApplicationListener</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnvironmentPostProcessorApplicationListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SmartApplicationListener</span>, Ordered &#123;<br>	<span class="hljs-comment">// </span><br>  <span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onApplicationEvent</span><span class="hljs-params">(ApplicationEvent event)</span> &#123;<br>		<span class="hljs-keyword">if</span> (event <span class="hljs-keyword">instanceof</span> ApplicationEnvironmentPreparedEvent) &#123;<br>			onApplicationEnvironmentPreparedEvent((ApplicationEnvironmentPreparedEvent) event);<br>		&#125;<br>		<span class="hljs-keyword">if</span> (event <span class="hljs-keyword">instanceof</span> ApplicationPreparedEvent) &#123;<br>			onApplicationPreparedEvent();<br>		&#125;<br>		<span class="hljs-keyword">if</span> (event <span class="hljs-keyword">instanceof</span> ApplicationFailedEvent) &#123;<br>			onApplicationFailedEvent();<br>		&#125;<br>	&#125;<br>	<span class="hljs-comment">// </span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onApplicationEnvironmentPreparedEvent</span><span class="hljs-params">(ApplicationEnvironmentPreparedEvent event)</span> &#123;<br>		<span class="hljs-type">ConfigurableEnvironment</span> <span class="hljs-variable">environment</span> <span class="hljs-operator">=</span> event.getEnvironment();<br>		<span class="hljs-type">SpringApplication</span> <span class="hljs-variable">application</span> <span class="hljs-operator">=</span> event.getSpringApplication();<br>		<span class="hljs-keyword">for</span> (EnvironmentPostProcessor postProcessor : getEnvironmentPostProcessors(application.getResourceLoader(),<br>				event.getBootstrapContext())) &#123;<br>      <span class="hljs-comment">// 调用到 EnvironmentPostProcessor 的实现类 </span><br>      <span class="hljs-comment">// 例如：IntegrationPropertiesEnvironmentPostProcessor 的 postProcessEnvironment</span><br>      <span class="hljs-comment">// IntegrationPropertiesEnvironmentPostProcessor 会 初始化PropertiesxxxLoader 加载 properties文件</span><br>			postProcessor.postProcessEnvironment(environment, application);<br>		&#125;<br>	&#125;<br>  <span class="hljs-comment">// SpringApplication 的 ApplicationEnvironmentPreparedEvent（） 事件</span><br>  <span class="hljs-comment">// 调用进行 环境准备</span><br>  <span class="hljs-comment">//ApplicationPreparedEvent.  ApplicationFailedEvent</span><br>  <span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsEventType</span><span class="hljs-params">(Class&lt;? extends ApplicationEvent&gt; eventType)</span> &#123;<br>		<span class="hljs-keyword">return</span> ApplicationEnvironmentPreparedEvent.class.isAssignableFrom(eventType)<br>				|| ApplicationPreparedEvent.class.isAssignableFrom(eventType)<br>				|| ApplicationFailedEvent.class.isAssignableFrom(eventType);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>





<h1 id="第三部分-启动流程"><a href="#第三部分-启动流程" class="headerlink" title="第三部分 启动流程"></a>第三部分 启动流程</h1><h1 id="3-0-SpringBootApplication"><a href="#3-0-SpringBootApplication" class="headerlink" title="3.0 @SpringBootApplication"></a>3.0 @SpringBootApplication</h1><h2 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="SpringBootApplication"></a>SpringBootApplication</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@SpringBootConfiguration</span><br><span class="hljs-meta">@EnableAutoConfiguration</span><br><span class="hljs-meta">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span><br><span class="hljs-meta">      @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SpringBootApplication &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="EnableAutoConfiguration"></a>EnableAutoConfiguration</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@AutoConfigurationPackage</span><br><span class="hljs-meta">@Import(AutoConfigurationImportSelector.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableAutoConfiguration &#123;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Environment property that can be used to override when auto-configuration is</span><br><span class="hljs-comment">    * enabled.</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-type">String</span> <span class="hljs-variable">ENABLED_OVERRIDE_PROPERTY</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring.boot.enableautoconfiguration&quot;</span>;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Exclude specific auto-configuration classes such that they will never be applied.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> the classes to exclude</span><br><span class="hljs-comment">    */</span><br>   Class&lt;?&gt;[] exclude() <span class="hljs-keyword">default</span> &#123;&#125;;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Exclude specific auto-configuration class names such that they will never be</span><br><span class="hljs-comment">    * applied.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> the class names to exclude</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@since</span> 1.3.0</span><br><span class="hljs-comment">    */</span><br>   String[] excludeName() <span class="hljs-keyword">default</span> &#123;&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="AutoConfigurationImportSelector"><a href="#AutoConfigurationImportSelector" class="headerlink" title="AutoConfigurationImportSelector"></a>AutoConfigurationImportSelector</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoConfigurationImportSelector</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DeferredImportSelector</span>, BeanClassLoaderAware,<br>		ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered &#123;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AutoConfigurationEntry</span> <span class="hljs-variable">EMPTY_ENTRY</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AutoConfigurationEntry</span>();<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] NO_IMPORTS = &#123;&#125;;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Log</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LogFactory.getLog(AutoConfigurationImportSelector.class);<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PROPERTY_NAME_AUTOCONFIGURE_EXCLUDE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring.autoconfigure.exclude&quot;</span>;<br><br>	<span class="hljs-keyword">private</span> ConfigurableListableBeanFactory beanFactory;<br><br>	<span class="hljs-keyword">private</span> Environment environment;<br><br>	<span class="hljs-keyword">private</span> ClassLoader beanClassLoader;<br><br>	<span class="hljs-keyword">private</span> ResourceLoader resourceLoader;<br><br>	<span class="hljs-keyword">private</span> ConfigurationClassFilter configurationClassFilter;<br><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;<br>		<span class="hljs-keyword">if</span> (!isEnabled(annotationMetadata)) &#123;<br>			<span class="hljs-keyword">return</span> NO_IMPORTS;<br>		&#125;<br>		<span class="hljs-type">AutoConfigurationEntry</span> <span class="hljs-variable">autoConfigurationEntry</span> <span class="hljs-operator">=</span> getAutoConfigurationEntry(annotationMetadata);<br>		<span class="hljs-keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the &#123;<span class="hljs-doctag">@link</span> AutoConfigurationEntry&#125; based on the &#123;<span class="hljs-doctag">@link</span> AnnotationMetadata&#125;</span><br><span class="hljs-comment">	 * of the importing &#123;<span class="hljs-doctag">@link</span> Configuration <span class="hljs-doctag">@Configuration</span>&#125; class.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> annotationMetadata the annotation metadata of the configuration class</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the auto-configurations that should be imported</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">protected</span> AutoConfigurationEntry <span class="hljs-title function_">getAutoConfigurationEntry</span><span class="hljs-params">(AnnotationMetadata annotationMetadata)</span> &#123;<br>		<span class="hljs-keyword">if</span> (!isEnabled(annotationMetadata)) &#123;<br>			<span class="hljs-keyword">return</span> EMPTY_ENTRY;<br>		&#125;<br>		<span class="hljs-type">AnnotationAttributes</span> <span class="hljs-variable">attributes</span> <span class="hljs-operator">=</span> getAttributes(annotationMetadata);<br>		List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);<br>		configurations = removeDuplicates(configurations);<br>		Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);<br>		checkExcludedClasses(configurations, exclusions);<br>		configurations.removeAll(exclusions);<br>		configurations = getConfigurationClassFilter().filter(configurations);<br>		fireAutoConfigurationImportEvents(configurations, exclusions);<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AutoConfigurationEntry</span>(configurations, exclusions);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>







<h1 id="3-1-SpringApplication"><a href="#3-1-SpringApplication" class="headerlink" title="3.1 SpringApplication"></a>3.1 SpringApplication</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java">	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Create a new &#123;<span class="hljs-doctag">@link</span> SpringApplication&#125; instance. The application context will load</span><br><span class="hljs-comment">	 * beans from the specified primary sources (see &#123;<span class="hljs-doctag">@link</span> SpringApplication class-level&#125;</span><br><span class="hljs-comment">	 * documentation for details). The instance can be customized before calling</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@link</span> #run(String...)&#125;.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> resourceLoader the resource loader to use</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> primarySources the primary bean sources</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #run(Class, String[])</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #setSources(Set)</span><br><span class="hljs-comment">	 */</span><br><br><span class="hljs-comment">// ## SpringApplication()</span><br>	<span class="hljs-meta">@SuppressWarnings(&#123; &quot;unchecked&quot;, &quot;rawtypes&quot; &#125;)</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">SpringApplication</span><span class="hljs-params">(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources)</span> &#123;<br>		<span class="hljs-built_in">this</span>.resourceLoader = resourceLoader;<br>		Assert.notNull(primarySources, <span class="hljs-string">&quot;PrimarySources must not be null&quot;</span>);<br>		<span class="hljs-built_in">this</span>.primarySources = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;(Arrays.asList(primarySources));<br>		<span class="hljs-built_in">this</span>.webApplicationType = WebApplicationType.deduceFromClasspath();<br>		<span class="hljs-built_in">this</span>.bootstrapRegistryInitializers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<br>				getSpringFactoriesInstances(BootstrapRegistryInitializer.class));<br>		setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));<br>		setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));<br>		<span class="hljs-built_in">this</span>.mainApplicationClass = deduceMainApplicationClass();<br>	&#125;<br><br><br><span class="hljs-comment">// ## run() </span><br><span class="hljs-keyword">public</span> ConfigurableApplicationContext <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> &#123;<br>   <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.nanoTime();<br>  <span class="hljs-comment">// 一、</span><br>   <span class="hljs-type">DefaultBootstrapContext</span> <span class="hljs-variable">bootstrapContext</span> <span class="hljs-operator">=</span> createBootstrapContext();<br>   <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>   configureHeadlessProperty();<br>   <span class="hljs-type">SpringApplicationRunListeners</span> <span class="hljs-variable">listeners</span> <span class="hljs-operator">=</span> getRunListeners(args);<br>   listeners.starting(bootstrapContext, <span class="hljs-built_in">this</span>.mainApplicationClass);<br>   <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-type">ApplicationArguments</span> <span class="hljs-variable">applicationArguments</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultApplicationArguments</span>(args);<br>      <span class="hljs-type">ConfigurableEnvironment</span> <span class="hljs-variable">environment</span> <span class="hljs-operator">=</span> prepareEnvironment(listeners, bootstrapContext, applicationArguments);<br>      configureIgnoreBeanInfo(environment);<br>      <span class="hljs-type">Banner</span> <span class="hljs-variable">printedBanner</span> <span class="hljs-operator">=</span> printBanner(environment);<br>      context = createApplicationContext();<br>      context.setApplicationStartup(<span class="hljs-built_in">this</span>.applicationStartup);<br>      prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);<br>      refreshContext(context);<br>      afterRefresh(context, applicationArguments);<br>      <span class="hljs-type">Duration</span> <span class="hljs-variable">timeTakenToStartup</span> <span class="hljs-operator">=</span> Duration.ofNanos(System.nanoTime() - startTime);<br>      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.logStartupInfo) &#123;<br>         <span class="hljs-keyword">new</span> <span class="hljs-title class_">StartupInfoLogger</span>(<span class="hljs-built_in">this</span>.mainApplicationClass).logStarted(getApplicationLog(), timeTakenToStartup);<br>      &#125;<br>      listeners.started(context, timeTakenToStartup);<br>      callRunners(context, applicationArguments);<br>   &#125;<br>   <span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>      handleRunFailure(context, ex, listeners);<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(ex);<br>   &#125;<br>   <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-type">Duration</span> <span class="hljs-variable">timeTakenToReady</span> <span class="hljs-operator">=</span> Duration.ofNanos(System.nanoTime() - startTime);<br>      listeners.ready(context, timeTakenToReady);<br>   &#125;<br>   <span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>      handleRunFailure(context, ex, <span class="hljs-literal">null</span>);<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(ex);<br>   &#125;<br>   <span class="hljs-keyword">return</span> context;<br>&#125;<br></code></pre></td></tr></table></figure>









<h2 id="3-2-run"><a href="#3-2-run" class="headerlink" title="3.2 run()"></a>3.2 run()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><br></code></pre></td></tr></table></figure>



<h1 id="SpringBoot’s-spring-facorties"><a href="#SpringBoot’s-spring-facorties" class="headerlink" title="SpringBoot’s spring.facorties"></a>SpringBoot’s spring.facorties</h1><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># Logging Systems</span><br><span class="hljs-attr">org.springframework.boot.logging.LoggingSystemFactory</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.logging.logback.LogbackLoggingSystem.Factory,\</span><br><span class="hljs-string">org.springframework.boot.logging.log4j2.Log4J2LoggingSystem.Factory,\</span><br><span class="hljs-string">org.springframework.boot.logging.java.JavaLoggingSystem.Factory</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># PropertySource Loaders</span><br><span class="hljs-attr">org.springframework.boot.env.PropertySourceLoader</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.env.PropertiesPropertySourceLoader,\</span><br><span class="hljs-string">org.springframework.boot.env.YamlPropertySourceLoader</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># ConfigData Location Resolvers</span><br><span class="hljs-attr">org.springframework.boot.context.config.ConfigDataLocationResolver</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.context.config.ConfigTreeConfigDataLocationResolver,\</span><br><span class="hljs-string">org.springframework.boot.context.config.StandardConfigDataLocationResolver</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># ConfigData Loaders</span><br><span class="hljs-attr">org.springframework.boot.context.config.ConfigDataLoader</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.context.config.ConfigTreeConfigDataLoader,\</span><br><span class="hljs-string">org.springframework.boot.context.config.StandardConfigDataLoader</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Application Context Factories</span><br><span class="hljs-attr">org.springframework.boot.ApplicationContextFactory</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.web.reactive.context.AnnotationConfigReactiveWebServerApplicationContext.Factory,\</span><br><span class="hljs-string">org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext.Factory</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Run Listeners</span><br><span class="hljs-attr">org.springframework.boot.SpringApplicationRunListener</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.context.event.EventPublishingRunListener</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Error Reporters</span><br><span class="hljs-attr">org.springframework.boot.SpringBootExceptionReporter</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.FailureAnalyzers</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Application Context Initializers</span><br><span class="hljs-attr">org.springframework.context.ApplicationContextInitializer</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.context.ConfigurationWarningsApplicationContextInitializer,\</span><br><span class="hljs-string">org.springframework.boot.context.ContextIdApplicationContextInitializer,\</span><br><span class="hljs-string">org.springframework.boot.context.config.DelegatingApplicationContextInitializer,\</span><br><span class="hljs-string">org.springframework.boot.rsocket.context.RSocketPortInfoApplicationContextInitializer,\</span><br><span class="hljs-string">org.springframework.boot.web.context.ServerPortInfoApplicationContextInitializer</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Application Listeners</span><br><span class="hljs-attr">org.springframework.context.ApplicationListener</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.ClearCachesApplicationListener,\</span><br><span class="hljs-string">org.springframework.boot.builder.ParentContextCloserApplicationListener,\</span><br><span class="hljs-string">org.springframework.boot.context.FileEncodingApplicationListener,\</span><br><span class="hljs-string">org.springframework.boot.context.config.AnsiOutputApplicationListener,\</span><br><span class="hljs-string">org.springframework.boot.context.config.DelegatingApplicationListener,\</span><br><span class="hljs-string">org.springframework.boot.context.logging.LoggingApplicationListener,\</span><br><span class="hljs-string">org.springframework.boot.env.EnvironmentPostProcessorApplicationListener</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Environment Post Processors</span><br><span class="hljs-attr">org.springframework.boot.env.EnvironmentPostProcessor</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.cloud.CloudFoundryVcapEnvironmentPostProcessor,\</span><br><span class="hljs-string">org.springframework.boot.context.config.ConfigDataEnvironmentPostProcessor,\</span><br><span class="hljs-string">org.springframework.boot.env.RandomValuePropertySourceEnvironmentPostProcessor,\</span><br><span class="hljs-string">org.springframework.boot.env.SpringApplicationJsonEnvironmentPostProcessor,\</span><br><span class="hljs-string">org.springframework.boot.env.SystemEnvironmentPropertySourceEnvironmentPostProcessor,\</span><br><span class="hljs-string">org.springframework.boot.reactor.DebugAgentEnvironmentPostProcessor</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Failure Analyzers</span><br><span class="hljs-attr">org.springframework.boot.diagnostics.FailureAnalyzer</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.context.config.ConfigDataNotFoundFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.context.properties.IncompatibleConfigurationFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.context.properties.NotConstructorBoundInjectionFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.analyzer.BeanCurrentlyInCreationFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.analyzer.BeanDefinitionOverrideFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.analyzer.BeanNotOfRequiredTypeFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.analyzer.BindFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.analyzer.BindValidationFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.analyzer.UnboundConfigurationPropertyFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.analyzer.MutuallyExclusiveConfigurationPropertiesFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.analyzer.NoSuchMethodFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.analyzer.NoUniqueBeanDefinitionFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.analyzer.PortInUseFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.analyzer.ValidationExceptionFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.analyzer.InvalidConfigurationPropertyNameFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.analyzer.InvalidConfigurationPropertyValueFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.analyzer.PatternParseFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.liquibase.LiquibaseChangelogMissingFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.web.context.MissingWebServerFactoryBeanFailureAnalyzer,\</span><br><span class="hljs-string">org.springframework.boot.web.embedded.tomcat.ConnectorStartFailureAnalyzer</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Failure Analysis Reporters</span><br><span class="hljs-attr">org.springframework.boot.diagnostics.FailureAnalysisReporter</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.diagnostics.LoggingFailureAnalysisReporter</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Database Initializer Detectors</span><br><span class="hljs-attr">org.springframework.boot.sql.init.dependency.DatabaseInitializerDetector</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.flyway.FlywayDatabaseInitializerDetector,\</span><br><span class="hljs-string">org.springframework.boot.jdbc.AbstractDataSourceInitializerDatabaseInitializerDetector,\</span><br><span class="hljs-string">org.springframework.boot.jdbc.init.DataSourceScriptDatabaseInitializerDetector,\</span><br><span class="hljs-string">org.springframework.boot.liquibase.LiquibaseDatabaseInitializerDetector,\</span><br><span class="hljs-string">org.springframework.boot.orm.jpa.JpaDatabaseInitializerDetector,\</span><br><span class="hljs-string">org.springframework.boot.r2dbc.init.R2dbcScriptDatabaseInitializerDetector</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Depends On Database Initialization Detectors</span><br><span class="hljs-attr">org.springframework.boot.sql.init.dependency.DependsOnDatabaseInitializationDetector</span>=<span class="hljs-string">\</span><br><span class="hljs-string">org.springframework.boot.sql.init.dependency.AnnotationDependsOnDatabaseInitializationDetector,\</span><br><span class="hljs-string">org.springframework.boot.jdbc.SpringJdbcDependsOnDatabaseInitializationDetector,\</span><br><span class="hljs-string">org.springframework.boot.jooq.JooqDependsOnDatabaseInitializationDetector,\</span><br><span class="hljs-string">org.springframework.boot.orm.jpa.JpaDependsOnDatabaseInitializationDetector</span><br><br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Spring/" class="category-chain-item">Spring</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Spring/">#Spring</a>
      
        <a href="/tags/Java/">#Java</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Spring Boot + Framework</div>
      <div>http://example.com/2023/07/30/Spring家族/Spring Boot + Framework/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>where</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年7月30日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/07/30/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E9%9D%A2%E8%AF%95%E9%A2%98/" title="操作系统 面试题">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">操作系统 面试题</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/07/30/Java%E7%B2%BE%E9%80%9A/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-%E9%BB%91%E9%A9%AC/" title="并发编程-黑马">
                        <span class="hidden-mobile">并发编程-黑马</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
